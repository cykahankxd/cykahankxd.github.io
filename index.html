<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://cykahankxd.github.io">
  <title>DrivenHank的Cyka小博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个不论OI还是CTF都很菜，三批聚顶成分复杂的铁菜逼">
<meta property="og:type" content="website">
<meta property="og:title" content="DrivenHank的Cyka小博客">
<meta property="og:url" content="http://cykahankxd.github.io/index.html">
<meta property="og:site_name" content="DrivenHank的Cyka小博客">
<meta property="og:description" content="一个不论OI还是CTF都很菜，三批聚顶成分复杂的铁菜逼">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Driven·Cyka·Hank">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="DrivenHank的Cyka小博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #ccefff"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/kirno_seyana.jpg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="index.html">主页</a></li>
	        
				<li><a href="/tags/%E6%9D%82%E8%B0%88/">杂谈</a></li>
	        
				<li><a href="/tags/CTF/">CTF</a></li>
	        
				<li><a href="/tags/%E5%AD%A6%E4%B9%A0">学习</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/cykahankxd" title="github"><i class="icon-github"></i></a>
		        
					<a class="qq" target="_blank" href="https://user.qzone.qq.com/1670497988/infocenter" title="qq"><i class="icon-qq"></i></a>
		        
					<a class="bilibili" target="_blank" href="https://space.bilibili.com/110049824?spm_id_from=333.1007.0.0" title="bilibili"><i class="icon-bilibili"></i></a>
		        
					<a class="mail" target="_blank" href="mailto:1670497988@qq.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #ccefff"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/kirno_seyana.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author"></h1>
			</hgroup>
			
			
			
				
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/cykahankxd" title="github"><i class="icon-github"></i></a>
			        
						<a class="qq" target="_blank" href="https://user.qzone.qq.com/1670497988/infocenter" title="qq"><i class="icon-qq"></i></a>
			        
						<a class="bilibili" target="_blank" href="https://space.bilibili.com/110049824?spm_id_from=333.1007.0.0" title="bilibili"><i class="icon-bilibili"></i></a>
			        
						<a class="mail" target="_blank" href="mailto:1670497988@qq.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 25%"><a href="index.html">主页</a></li>
		        
					<li style="width: 25%"><a href="/tags/%E6%9D%82%E8%B0%88/">杂谈</a></li>
		        
					<li style="width: 25%"><a href="/tags/CTF/">CTF</a></li>
		        
					<li style="width: 25%"><a href="/tags/%E5%AD%A6%E4%B9%A0">学习</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-机械设计课程设计自动机（东林特供版）开发进度汇总板" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/09/09/%E6%9C%BA%E6%A2%B0%E8%AE%BE%E8%AE%A1%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%88%E4%B8%9C%E6%9E%97%E7%89%B9%E4%BE%9B%E7%89%88%EF%BC%89%E5%BC%80%E5%8F%91%E8%BF%9B%E5%BA%A6%E6%B1%87%E6%80%BB%E6%9D%BF/">机械设计课程设计自动机（东林特供版）开发进度汇总板</a>
    </h1>
  

        
        <a href="2023/09/09/%E6%9C%BA%E6%A2%B0%E8%AE%BE%E8%AE%A1%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%88%E4%B8%9C%E6%9E%97%E7%89%B9%E4%BE%9B%E7%89%88%EF%BC%89%E5%BC%80%E5%8F%91%E8%BF%9B%E5%BA%A6%E6%B1%87%E6%80%BB%E6%9D%BF/" class="archive-article-date">
  	<time datetime="2023-09-09T08:10:41.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-09-09</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>由于网络上的素材大抵都是一、二级圆柱锥齿轮变速器机构的设计，没有像你林这样的自主命题+自选教材，思来想去，为了避免更多学弟学妹遁入淘门和拼门，遂开启此项目的开发计划。</p>
<p>如上，仍待补充</p>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>目前仅实现电动机的选择及带轮、齿轮的设计（待完善），可视化参数调整界面和整机相关功能仍在开发中，期待有dalao能issue纠错或补充</p>
<h3 id="如何参与开发"><a href="#如何参与开发" class="headerlink" title="如何参与开发"></a>如何参与开发</h3><p>你可以通过向开发者提出申请来参与开发，或者直接向开发者提交补充文件等，你也可以通过issue提出合理建议，或纠正程序的错误。</p>
<p>交流群：NEFU_AutoMachanic(901252688)，验证回答github即可</p>
<p>项目链接：<a target="_blank" rel="noopener" href="https://github.com/cykahankxd/Automatic_Mechanica_Course_Designing">开罐即食</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
        <div class="article-pop-out tagcloud">
          <i class="icon-tuding"></i>
          <a class="article-tag-list-link color3">置顶</a>
        </div>
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">学习</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">开发日志</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/09/09/%E6%9C%BA%E6%A2%B0%E8%AE%BE%E8%AE%A1%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%88%E4%B8%9C%E6%9E%97%E7%89%B9%E4%BE%9B%E7%89%88%EF%BC%89%E5%BC%80%E5%8F%91%E8%BF%9B%E5%BA%A6%E6%B1%87%E6%80%BB%E6%9D%BF/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-FlareOn4做题合集" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2024/03/29/FlareOn4%E5%81%9A%E9%A2%98%E5%90%88%E9%9B%86/">FlareOn4做题合集</a>
    </h1>
  

        
        <a href="2024/03/29/FlareOn4%E5%81%9A%E9%A2%98%E5%90%88%E9%9B%86/" class="archive-article-date">
  	<time datetime="2024-03-29T12:34:43.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2024-03-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="notepad"><a href="#notepad" class="headerlink" title="notepad"></a>notepad</h3><p><em>ps.在做这道题之前请注意<a target="_blank" rel="noopener" href="https://twitter.com/pmontesel/status/905543404326670336">如下内容</a>：</em></p>
<blockquote>
<p>If “notepad.exe” in #flareon4 on Win10 crashes just patch 0x01013C54 to make it “push 0x6e2bca17”</p>
</blockquote>
<p><em>ps.2 以及，flareon上的原装题目大概率只适用于win7及以下部分版本的windows，建议部分无法正常打开的题目替换为buu上的移植版食用</em></p>
<p>打开一看，除了一开始会显示某些莫名其妙的时间之外，似乎就是一个普通的32位记事板？</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dnotepad_pic1.png"></p>
<p>虽然不知道它在干什么，但是当我们点进去的时候，我们会看到start调用了一些东西：</p>
<pre><code>strcpy(v27, &quot;%USERPROFILE%&quot;);
strcpy(v8, &quot;\\flareon2016challenge&quot;);
strcpy(v10, &quot;ImageHlp.dll&quot;);
strcpy(v9, &quot;CheckSumMappedFile&quot;);
strcpy(v15, &quot;user32.dll&quot;);
strcpy(v12, &quot;MessageBoxA&quot;);
</code></pre>
<p>FlareOn4是2017年的，我们要把上一届比赛（16年）的题目给弄下来放自己的用户文件夹里头。试着再度运行，但是除了什么跟刚才一样之外都没发生……等下，什么时候多出来一个<code>key.bin</code>？</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dnotepad_pic2.png"></p>
<p>虽然但是，我们回头先看看程序本体，主函数里面出现了成吨类似的结构：</p>
<pre><code>v16[0] = sub_1015310((int)v5, 0x63D6C065);
</code></pre>
<p>动态调试可以发现其实际上是对<code>kernel32.dll</code>库的调用，每次将一个函数的地址压栈。而我们将整个调用链拉出来会发现，start部分似乎就是将上述文件夹中符合条件（并且这个条件多半和文件的更新日期，也就是题目文件编译的日期有关系）的程序提出来，塞点什么。</p>
<pre><code>Stack[00000840]:000DFEF0 aUser32Dll_0 db &#39;user32.dll&#39;,0
Stack[00000840]:000DFEFB db    0
Stack[00000840]:000DFEFC dd offset kernel32_FindFirstFileA
Stack[00000840]:000DFF00 dd offset kernel32_FindNextFileA
Stack[00000840]:000DFF04 dd offset kernel32_FindClose
Stack[00000840]:000DFF08 dd 0
Stack[00000840]:000DFF0C dd offset kernel32_CreateFileA
Stack[00000840]:000DFF10 dd offset kernel32_CreateFileMappingA
Stack[00000840]:000DFF14 dd offset kernel32_MapViewOfFile
Stack[00000840]:000DFF18 dd offset kernel32_CloseHandle
Stack[00000840]:000DFF1C dd offset kernel32_WriteFile
Stack[00000840]:000DFF20 dd offset kernel32_GetFileSize
Stack[00000840]:000DFF24 dd offset kernel32_FlushViewOfFile
Stack[00000840]:000DFF28 dd offset kernel32_LoadLibraryA
Stack[00000840]:000DFF2C dd offset kernel32_GetProcAddress
Stack[00000840]:000DFF30 dd 0
Stack[00000840]:000DFF34 dd offset kernel32_GetModuleHandleA
Stack[00000840]:000DFF38 dd offset kernel32_UnmapViewOfFile
Stack[00000840]:000DFF3C dd 0
Stack[00000840]:000DFF40 dd 0
Stack[00000840]:000DFF44 dd 0
Stack[00000840]:000DFF48 dd 0
Stack[00000840]:000DFF4C dd offset kernel32_ExpandEnvironmentStringsA
Stack[00000840]:000DFF50 dd offset kernel32_FileTimeToSystemTime
Stack[00000840]:000DFF54 dd offset kernel32_GetTimeFormatA
Stack[00000840]:000DFF58 dd offset kernel32_GetDateFormatA
Stack[00000840]:000DFF5C dd offset kernel32_ReadFile
</code></pre>
<p>问题来了，是哪几个程序呢？比较简单粗暴的办法是挨个试一遍，最后，发现challenge1、DudeLocker、khaki和unknown在题目的notepad运行之后，都会有一些莫名其妙的弹窗，而唯独unknown的弹窗是”What’s wrong with my keyfile?”。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dnotepad_pic3.png"></p>
<p>不用猜，unknown肯定是最后一个打开的程序，而第一个肯定是notepad.exe。至于剩下几个的顺序，一种办法是挨个试一遍，三个相异元素的全排列而已（实际上你直接按首字母排序的话，顺序运行下来就是一遍过）。还有一种是按时间查找，但是因为部分题目使用的是buu的移植版，使用上一个打开的程序的弹窗里的时间可能还是对不上号。</p>
<p>至于最后一种，每次运行完上一个程序，key.bin里肯定会多出些什么，直接将里面每次多出的内容到还没打开的程序里挨个找一遍，绝对会找到匹配的结果，以DudeLocker为例：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dnotepad_pic4.png"></p>
<p>反正怎么顺手怎么来。最后的flag一定是：</p>
<blockquote>
<p><a href="mailto:&#98;&#108;&#x34;&#x35;&#55;&#x5f;&#x66;&#x72;&#x30;&#109;&#95;&#x74;&#x68;&#51;&#x5f;&#x70;&#x34;&#53;&#55;&#x40;&#x66;&#x6c;&#97;&#x72;&#101;&#45;&#x6f;&#x6e;&#46;&#99;&#111;&#x6d;">&#98;&#108;&#x34;&#x35;&#55;&#x5f;&#x66;&#x72;&#x30;&#109;&#95;&#x74;&#x68;&#51;&#x5f;&#x70;&#x34;&#53;&#55;&#x40;&#x66;&#x6c;&#97;&#x72;&#101;&#45;&#x6f;&#x6e;&#46;&#99;&#111;&#x6d;</a></p>
</blockquote>
<p><em>谁家好人会用自己出过的题目当题目内容，还放在C盘占空间的啊kora</em></p>
<h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><p>看到代码的一瞬间，我有点害怕这玩意会不会有什么php特性：</p>
<pre><code>&lt;?php $o__o_ = base64_decode(
    &quot;QAYLHhIJbzIQC...&quot;
);
$o_o = isset($_POST[&quot;o_o&quot;]) ? $_POST[&quot;o_o&quot;] : &quot;&quot;;
$o_o = md5($o_o) . substr(MD5(strrev($o_o)), 0, strlen($o_o));
for ($o___o = 0; $o___o &lt; 2268; $o___o++) &#123;
    $o__o_[$o___o] = chr((ord($o__o_[$o___o]) ^ ord($o_o[$o___o])) % 256);
    $o_o .= $o__o_[$o___o];
&#125;
if (MD5($o__o_) == &quot;43a141570e0c926e0e3673216a4dd73d&quot;) &#123;
    if (isset($_POST[&quot;o_o&quot;])) &#123;
        @setcookie(&quot;o_o&quot;, $_POST[&quot;o_o&quot;]);
    &#125;
    $o___o = create_function(&quot;&quot;, $o__o_);
    unset($o_o, $o__o_);
    $o___o();
&#125; else &#123;
    echo &#39;&lt;form method=&quot;post&quot; action=&quot;shell.php&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;o_o&quot; value=&quot;&quot;/&gt;&lt;input type=&quot;submit&quot; value=&quot;&amp;gt;&quot;/&gt;&lt;/form&gt;&#39;;
&#125; ?&gt;
</code></pre>
<p>但好在事实上并没有。不过这么长的密文看上去有点哈人，还拿字符串正反两遍的md5的合体做key，64位，看着更哈人了。不过就没啥招解决吗？</p>
<p>注意看这一句代码：</p>
<pre><code>$o_o .= $o__o_[$o___o];
</code></pre>
<p>如果说这个for要正常运行不至于抛出索引越界（毕竟key只有64位，但这for的上限足足2268），那这个<code>.=</code>只剩下一种可能：拿加密后的字符当key的末尾继续加密。也就是说，第65位开始都可以用前文直接爆。</p>
<p>可问题在于：在生成后续的key之前，前文也必须得被加密啊，所以根本问题还是怎么爆出原文和key。</p>
<p>一种很浅显的办法就是遍历所有可能用到的php函数，因为密文解密的结果实际上就是php代码：</p>
<pre><code>@setcookie(&quot;o_o&quot;, $_POST[&quot;o_o&quot;]);
create_function(&quot;&quot;, $o__o_);
</code></pre>
<p>但是逆向手可能很难知道所有可能的CTF常用php函数，所以赛场上得去请教web手或者挨个试一遍。</p>
<p>另一种更简单的办法，MD5本身只有16个字符的字符集，我们直接循环前64位，对于每一位，根据之前的算法来看，从第一次根据key加密过后，之后每64位的加密都是以前64位为key加密，也就是说，我们爆破每一位key的时候，只需要向后以64为间隔循环异或，检测值是否为阳间字符就行了。（思路参考<a target="_blank" rel="noopener" href="https://thomasw.dev/post/flareon-2017-10-shell/">Thomasd的博客</a>和<a target="_blank" rel="noopener" href="https://mokhdzanifaeq.github.io/2017/10/17/flareon-2017/">mkhdznfq的博客</a>）</p>
<pre><code>from base64 import b64decode

f = open(&#39;output.txt&#39;, &#39;w&#39;)
crypted = b64decode(&quot;QAYLHhIJbzIQC...&quot;)


def check(offset, tmp):
    for sit in range(offset, 2268, 64):  # 以64为间隔开始遍历，判断是否为正常字符
        tmp = (crypted[sit] ^ tmp) % 256  # 继续以当前加密字符为key向后遍历
        if 32 &lt;= tmp &lt; 127 or tmp == 10 or tmp == 13:  # 若为正常字符
            continue
        return -1
    return 1


for i in range(64):  # 剩下的事情就是遍历md5字符集了
output = &#39;md5set[&#39; + str(i) + &#39;]=[&#39;
for j in md5charset:
    if check(i, ord(j)) == 1:
        output += &#39;\&#39;&#39; + j + &#39;\&#39;, &#39;
output = output[:-2] + &#39;]&#39;
print(output, file=f)

f.close()
</code></pre>
<p>但是如果是纯暴力，最后爆出来的产物还是会产生一些不定结果。但既然都暴力了那为什么不爆到底呢？递归生成树，挨个试一遍！</p>
<p>然而最后发现根本跑不通。究其原因还是64位的超长key带来的巨大运算量让人难以接受（足足10^28种可能性）。那剩下的只能是先手动调整key，看看能不能产生一些可能可以看见的结果：</p>
<pre><code>from base64 import b64decode
from hashlib import *

crypted = b64decode(
    &quot;QAYLHhIJbzIQCl...&quot;)
key = &quot;...&quot;
key = [char for char in key]
output = &quot;&quot;

for i in range(len(crypted)):
    output += chr((crypted[i] ^ ord(key[i])) % 256)
    key += output[i]

print(output)
</code></pre>
<p>这个过程是相当漫长与折磨的。就算你脑子里有一万种php指令，调整key也得半天。所以我们需要把可能的明文也打印出来，看看到底啥玩意是可能整理出一个可用的cookie的明文，然后再找对应的key：</p>
<pre><code>from base64 import b64decode

f = open(&#39;output.txt&#39;, &#39;w&#39;)
f2 = open(&#39;output_origin.txt&#39;, &#39;w&#39;)
crypted = b64decode(&quot;QAYLHhIJbzIQC...&quot;)
md5charset = &quot;0123456789abcdef&quot;


def check(offset, tmp):
    for sit in range(offset, 2268, 64):  # 以64为间隔开始遍历，判断是否为正常字符
        tmp = (crypted[sit] ^ tmp) % 256  # 继续以当前加密字符为key向后遍历
        if 32 &lt;= tmp &lt; 127 or tmp == 10 or tmp == 13:  # 若为正常字符
            continue
        return -1
    return 1


def exchange(tmp):
    if 32 &lt;= tmp &lt; 127:
        return chr(tmp)
    else:
        return &#39;\\x&#39; + str(tmp)


for i in range(64):  # 剩下的事情就是遍历md5字符集了
    output = &#39;md5set[&#39; + str(i) + &#39;]=[&#39;
    output_origin = &#39;original_set[&#39; + str(i) + &#39;]=[&#39;
    for j in md5charset:
        if check(i, ord(j)) == 1:
            output += &#39;\&#39;&#39; + j + &#39;\&#39;, &#39;
            output_origin += &#39;\&#39;&#39; + exchange((crypted[i] ^ ord(j)) % 256) + &#39;\&#39;, &#39;
    output = output[:-2] + &#39;]&#39;
    output_origin = output_origin[:-2] + &#39;]&#39;
    print(output, file=f)
    print(output_origin, file=f2)

f.close()
f2.close()
</code></pre>
<p>然后再把生成的可能明文和可能key一个个比对，看看什么样的key组合可以凑出一个算是cookie的明文。这个过程需要比较繁琐的手工，但没办法，谁叫电脑也不一定跑得动呢？</p>
<p>手操得出<code>key=db6952b84a49b934acb436418ad9d93d237df05769afc796d067bccb379f2cac</code>，再塞回去得到cookie：</p>
<pre><code>$d=&#39;&#39;;
$key = &quot;&quot;;
if (isset($_POST[&#39;o_o&#39;]))
  $key = $_POST[&#39;o_o&#39;];
if (isset($_POST[&#39;hint&#39;]))
  $d = &quot;www.p01.org&quot;;
if (isset($_POST[&#39;t&#39;])) &#123;
  if ($_POST[&#39;t&#39;] == &#39;c&#39;) &#123;
    $d = base64_decode(&#39;SDcGHg1feV...&#39;);
    $key = preg_replace(&#39;/(.)../&#39;, &#39;$1&#39;, $key);
  &#125;
  if ($_POST[&#39;t&#39;] == &#39;s&#39;) &#123;
    $d = base64_decode(&#39;VBArMg1H...&#39;);
    $key = preg_replace(&#39;/.(.)./&#39;, &#39;$1&#39;, $key);
  &#125;
  if ($_POST[&#39;t&#39;] == &#39;w&#39;) &#123;
    $d = base64_decode(&#39;DycdGg1hYj...&#39;);
    $key = preg_replace(&#39;/..(.)/&#39;, &#39;$1&#39;, $key);
  &#125;
  while(strlen($key) &lt; strlen($d))
    $key = $key.$key;
  $d = $d ^ $key;
&#125;
if (strlen($d))
    echo $d;
else
    echo &#39;&lt;form action=&quot;shell.php&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;o_o&quot; value=&quot;&#39;.$key.&#39;&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;t&quot; value=&quot;c&quot;&gt; Raytraced Checkboard&lt;br&gt; &lt;input type=&quot;radio&quot; name=&quot;t&quot; value=&quot;s&quot;&gt; p01 256b Starfield&lt;br&gt; &lt;input type=&quot;radio&quot; name=&quot;t&quot; value=&quot;w&quot;&gt; Wolfensteiny&lt;br&gt;&lt;input type=&quot;submit&quot; value=&quot;Show&quot;/&gt;&lt;/form&gt;&#39;;
</code></pre>
<p>但是这里的<code>preg_replace</code>又在干什么？其实通过在线编译，我们可以知道这里的每一项<code>preg_replace</code>都分别在取key中每3个字符的第一&#x2F;二&#x2F;三个，分别组成一个新的key用于进行异或：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/buu_%5BFlareOn2017%5D_shell_pic1.png"></p>
<p>剩下的事情就好办了，爆！</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/buu_%5BFlareOn2017%5D_shell_pic2.png"></p>
<p>啊？！</p>
<p>所以这个POST的key传进来的时候还带变的是吗？这下多爆三个密文了，这么玩是吧.jpg，更悲惨的是这回不是md5了，这下任何字符都有可能了。</p>
<p>而且，还有一件可怕的事情，我们到现在依旧不知道flag是藏在代码里还是就是哪一个环节的key。</p>
<p>不过嘛，思路还是有的。注意这里：</p>
<pre><code>if (isset($_POST[&#39;hint&#39;]))
  $d = &quot;www.p01.org&quot;;
</code></pre>
<p>我们点进去一看，发现这是个压行老哥的博客，专注压行二十年。但我们不止要查看相关的代码，从直觉上看，上述密文拼接起来有足足998个字符，而整个网页字数相近且符合出题日期，并且含有有效代码的文章有：DWITTER SON1K、WOLFENSTEINY、TEA STORM等。而它们之中的代码都是html。顺着这条线索，我们推测原文当中应当含有“&lt;body”之类的，html特有的字段。并且，由于第三部分的长度比第1、2段甚至多出整整42个字符，我们甚至可以直接开始暴力循环密文后42位，看看有没有什么捞的着的东西：</p>
<pre><code>from base64 import b64decode

code = [[] for i in range(3)]
code[2] = b64decode(&#39;DycdGg1hY...&#39;)
origin = &quot;&lt;/body&gt;&quot;
origin = [ord(char) for char in origin]

# 密文最短只有316位
for i in range(316, len(code[2]) - len(origin)):
    tmp = &quot;&quot;
    for j in range(len(origin)):
        tmp += chr(code[2][i + j] ^ origin[j])
    print(&quot;offset %i decode is %s&quot; % (i, tmp))
</code></pre>
<p>最后结果也就三个能看的，还都是乱码。但是，秉持着不会做就瞎蒙乱猜的原则，这三个能看的结果当中，也就一个能和网页沾上边的：<code>部分密文^&#39;&lt;/body&gt;&#39;=@a-.m3Q</code></p>
<p>且慢，如果我们看一看原比赛的网址：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/buu_%5BFlareOn2017%5D_shell_pic3.png"></p>
<pre><code>__@__a__-__.__m__3__Q
   flare-on.com
     *  *  *  *
</code></pre>
<p>W……T……F……什么顶级抽象脑洞</p>
<p>然后我们有端联想一下，这玩意的末位如果真是“@+比赛官网”，那我们不就可以通过暴力向前遍历完整版密文找到key可能的长度，进而暴力遍历可能的字符找到flag吗？所以我们直接对着三段密文挨个试一遍：</p>
<pre><code>from base64 import b64decode

code = [[] for i in range(3)]
code[0] = b64decode(&#39;SDcGHg...&#39;)
code[1] = b64decode(&#39;VBArMg1H...&#39;)
code[2] = b64decode(&#39;DycdGg1h...&#39;)

possible_key = [[] for i in range(3)]  # @flare-on.com，但根据原算法，一份key拆三份用
possible_key[0] = &#39;froc&#39;
possible_key[1] = &#39;leno&#39;
possible_key[2] = &#39;@a-.m&#39;

f = open(&quot;burp_second_output.txt&quot;, &#39;w&#39;)
for i in range(3):
    f.write(&quot;in code %i:\n&quot; % i)
    for j in range(len(code[i]) - len(possible_key[i])):
        tmp = &quot;&quot;
        possible_tag = 1
        for k in range(len(possible_key[i])):
            c = (code[i][j+k] ^ ord(possible_key[i][k])) % 256
            tmp += chr(c)
            if c &lt; 32 or c &gt; 126:
                possible_tag = 0
        if possible_tag == 1:
            f.write(&quot;   offset %i decode is %s\n&quot; % (j, tmp))
</code></pre>
<p>于是我们可以清晰地看到一些字段中浮现了html相关字段，以及这位p01老哥的部分代码字段。其中以这里尤为明显：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/buu_%5BFlareOn2017%5D_shell_pic4.png"></p>
<p>考虑到这个箭头应该不太可能凭空出现（实际上那是html的注释标志），我们姑且认为flag长度在39左右。这样的话，每部分key还有8~9位未知。于是我们开始尝试爆破，再结合wolfensteiny文章的源代码，原文的算法之类的，以及之前的暴力代码多跑几遍一顿瞎猜：</p>
<pre><code>from base64 import b64decode

f = open(&#39;output2.txt&#39;, &#39;w&#39;)
f2 = open(&#39;output2_origin.txt&#39;, &#39;w&#39;)

code = [[] for i in range(3)]  # 继续拆成三个解
code[0] = b64decode(&#39;SDcGHg1f...&#39;)
code[1] = b64decode(&#39;VBArMg1HY...&#39;)
code[2] = b64decode(&#39;DycdGg1hYjl8...&#39;)
keylen = [13, 13, 13]


def check(offset, enc, tmp, keyl):  # 输入当前偏移量、待解密字符串、当前待判断key位，当前key长度
    for sit in range(offset, len(enc), keyl):
        c = (enc[sit] ^ tmp) % 256
        if 32 &lt;= c &lt;= 126 or c == 10 or c == 13:
            continue
        else:
            return -1
    return 1


def exchange(tmp):
    if 32 &lt;= tmp &lt;= 126:
        return chr(tmp)
    else:
        return &#39;\\x&#39; + str(tmp)


for i in range(9):  # key剩余位数第i位
    for k in range(3):  # 第k个密文串/key
        output = &#39;possible_key[&#39; + str(3*i+k) + &#39;]=[&#39;
        output_origin = &#39;original_set[&#39; + str(3*i+k) + &#39;]=[&#39;
        for j in range(32, 127):  # ascii表第j个可用字符
            if check(i, code[k], j, keylen[k]) == 1:
                output += &#39;\&#39;&#39; + chr(j) + &#39;\&#39;, &#39;
                output_origin += &#39;\&#39;&#39; + exchange((code[k][i] ^ j) % 256) + &#39;\&#39;, &#39;
        output = output + &#39;]&#39;
        output_origin = output_origin + &#39;]&#39;
        print(output, file=f)
        print(output_origin, file=f2)

f.close()
f2.close()
</code></pre>
<p>考虑到剩下的密文也极有可能是html代码，那么开头的字符也很有可能是三个重复的html头，并且按出题人的习惯还会接两个不同ascii码的换行，我们照着这个思路一个位一个位的比对：</p>
<pre><code># th3_xOr_is_waaaay_too_w34k@

t_rsaatwk
&lt;html&gt;


hx__ayo3@
&lt;html&gt;


3Oiwa_o4
&lt;html&gt;
 
 
</code></pre>
<p>这不但验证了我们之前对key尾的猜想，还把前面完完整整的吐出来了。所以最后的结果应该是：</p>
<blockquote>
<p>th3_ xOr_ is_ waaaay_ too_ <a href="mailto:&#119;&#51;&#52;&#x6b;&#x40;&#x66;&#108;&#97;&#114;&#x65;&#45;&#111;&#110;&#x2e;&#x63;&#111;&#109;">&#119;&#51;&#52;&#x6b;&#x40;&#x66;&#108;&#97;&#114;&#x65;&#45;&#111;&#110;&#x2e;&#x63;&#111;&#109;</a></p>
</blockquote>
<p>顺带，你把这个key放到php运行器上解密，你会发现这些明文都是p01老哥的杰作……套了些不明所谓的玩意。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/buu_%5BFlareOn2017%5D_shell_pic5.png"></p>
<p><em>ps.1 你确定这题真的不放在misc或者crypto？<br>ps.2 在最后的爆破环节我一开始把长度当40看爆了半天，还调了一整个晚上的算法，最后才发现其实是我一开始看的39，我人傻了（各种意义上）</em><br><em>ps.3 出题人你(wo)没(cxx)有(ni)心(mx)</em><br><em>ps.4 buu导题的时候导错了flag导致中间的’O’变成’0’才能过，忘周知</em></p>
<h3 id="zsud"><a href="#zsud" class="headerlink" title="zsud"></a>zsud</h3><p>一上来发现像是迷宫题，但又不那么正统，我们的视野直接被封死了，目前唯一可以得到信息的途径就是h(elp)和l(ook)：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dzsud_pic1.png"></p>
<pre><code>Game commands:
h[elp] - See this help
q[uit] - Exit the game

Area commands:
l[ook] [object] - Look at the room [or at an optional object)
n[orth] - Move north
s[outh] - Move south
e[ast] - Move east
w[est] - Move west
u[p] - Move up
d[own] - Move down

Personal commands:
say &lt;someone&gt; &lt;words...&gt; - Say &lt;words...&gt; to &lt;someone&gt;
wear &lt;inventory-item&gt; - Put &lt;inventory-item&gt; on
remove &lt;thing&gt; - Take &lt;thing&gt; off

Inventory commands:inv[entory] - Check your inventory
get &lt;object&gt; [location] - Get object [from within optional location])
drop &lt;object&gt; - Put object down
</code></pre>
<p>方向键并不是wasd而是东南西北，但不管怎么说，我们都应该四处转转。往南走是outside直接死路，往北走的话，里面会有一些奇怪的结构，于是我们直接画一张地图，顺带把有关键道具的地方给标注了：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dzsud_pic2.png"></p>
<p>但是我们对于现在要做的事情一头雾水，遂喂die和ida，找到一条鲸鱼以及它的所在函数和地址：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dzsud_pic3.png"></p>
<p>但打开程序跟进网页之后也只剩下一条鲸鱼：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dzsud_pic4.png"></p>
<p>其它什么也没有，感觉脑子要喂鲸鱼了。但是我们发现，打开时会出现一个<code>clrhost</code>的调试信息，搜一下是个能在汇编程序中打开一个CLR环境，并通过一个自启动的控制台跑C#代码的玩意。相关内容可以参考<a target="_blank" rel="noopener" href="https://github.com/KevinVoell/CLRHost">CLRhost本体</a>以及<a target="_blank" rel="noopener" href="https://blog.csdn.net/lidandan2016/article/details/77868043">lidandan2016
</a>的文章。</p>
<p>我们还发现某些函数调用了一些空全局变量作为函数，可能在程序运行过程中会有一些对.NET调用库的解码也说不定？用CheatEngine一开果真看到了不对劲的<code>whiskey_tango_flareon.dll</code>。</p>
<p>虽然但是，回到解谜游戏本体，我们似乎发现从drawers里拿走钥匙之后，再前往Mandiant offices，key上不但有新内容，我们还发现有新路可以走了，新路连到的work area似乎是一个无限大且方向延伸为6个的空间：</p>
<pre><code>&gt; l key
You BANKbEPxukZfP2EikF8jN04iqGJY0RjM3p++Rci2RiUFvS9RbjWYzbbJ3BSerzwGc9EZkKTvv1JbHOD6ldmehDxyJGa60UJXsKQwr9bU3WsyNkNsVd/XtN9/6kesgmswA5Hvroc2NGYa91gCVvlaYg4U8RiyigMCKj598yfTMc1/koEDpZUhl9Dy4ZhxUUFHbiYRXFARiYNSiqJAEYNB0r93nsAQPNogNrqg23OYd3RPp4THd8G6vkJUXltRgXv7px2CWdOHuxKBVq6EduMFSKpnNB7jAKojNf1oGECrtR5pHdG1LhtTtH6lFE7IVTEKOHD+TMO1VUh0Bpa37WhIAKEwpuyp5+Tspyh0GidHtYcNWfzLNBXymmrhzvta2nJ+FtI6KWXgAAMJdUCy6YrGbWFoR2ChpeWlZLf7cQ1Awh27y6hOV19R6IKOpQzCOQLNjUplm4SOltwRU0pH6BYCeoYXbyRl3kk92uXoBsBXwxdo9QoLBOAdJmKnN95VBT03a+jS3ku3YLwXR29GIlsCfdkVKr4J1d/Xal//e+Bqq1xMEucIdnNSwr4hlOtdpLrPyfnCVkBcadlRC6hGitbptCknTCUniXCCOE1NkWSVi3v5VrXkPGAvw/iRu7F2BimC+o3tIdWPpxkcfks6zVQSiFJjVzrt28+QUb28+YRaCkPhfZALYKQLU3DR5YJw64sL40tykTI68evyRF/Fnp4VTNlWQHXPJ+Y6yCHZnrb8NdIRDPfm1wxOQJbdeaEZSa3AgqI2wW0pPBnf69vVAq4qjxyrI1LPL9hzd7cBfqnohjyDy/t78TZOh0hX++W6zkMl0Ez6I2CHxop3vzg1/9iQig0WAglmdqiAhKbDFSM7kGPf5Reyphx27uzxHAllP7LrX1vF7o9v4vcCrHE7dJpuisSWhsx3rtJsBA15mdMAbuj1ErOpWLMbXCYfhpSj6GLOHOU/PqeDoktZs9BLS+V11PcxaVVwHBGfCimMe61mSFD0hhYJXgTxbwKDvIS...
----------
&gt; n
...
You go north
The key emanates some warmth...
the Mandiant offices
This is where the magic happens. To the west, open work areas, cubicles, offices, and adjustable desks stretch out and intersect in a dazzling maze as far as the eye can see.  

Exits: North South East 
</code></pre>
<p>但是这个key到底是用来开啥的尚且未知，我们拿着钥匙稍微走走，会发现部分操作会使得钥匙变热并且让密文部分解密，部分输出<code>Hmm...</code>并导致解密停止。</p>
<pre><code>&gt; n
You go north
The key emanates some warmth...
the northeast hallway
This hallway links the snack/lunch area with the IT access junction.  

Exits: South East 

&gt; l key
You can start to zXykaHk29xWQzs7kNrmhu4oN0TsxM7iyJ4tmttuCijPJ2G0VA3xCFLvUnmYb/P3Ae+sO/wdNm1OpZX5AltsADOBqgr2uErcM9BeKqlOCmfH2SPfDXoZN7p5PoZe9RPv0reF1C6Rse23MtetFeffgvPztw/ZRnxIiAg9jKhL8……
</code></pre>
<p>思来想去，应该是要让钥匙全程红温才能把这一大串密文解密完成。问题来了，我们该怎么走才能让钥匙全程热乎呢？</p>
<p>一种方法当然是暴力走无数遍，直觉来看，表层肯定是顺时针或者逆时针把整个有限部分转一遍（测试是从大厅开始顺时针，然后宿舍先女后男），然后再去无限房摸路，但是那样未免也太耗时间（参考<a target="_blank" rel="noopener" href="https://thomasw.dev/post/flareon-2017-7-zsud/">Thomas佬的题解</a>，他的暴力代码整整走了一个钟头）。</p>
<p>另外一种就是直接通过IDA的东西提取dll，然后从里面找寻路的办法。我们先从CE里头看上面提到的dll的函数包含：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dzsud_pic5.png"></p>
<p>再从IDA里头找到对应的MZ头：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BFlareOn4%5Dzsud_pic6.png"></p>
<p>然后把所有看着挺像的东西dump出来塞进DNSpy里：</p>
<pre><code>private static string Decrypt2(byte[] cipherText, string key)
&#123;
    byte[] bytes = Encoding.UTF8.GetBytes(key);
    byte[] array = new byte[16];
    byte[] iv = array;
    string result = null;
    using (RijndaelManaged rijndaelManaged = new RijndaelManaged())
    &#123;
        rijndaelManaged.Key = bytes;
        rijndaelManaged.IV = iv;
        ICryptoTransform transform = rijndaelManaged.CreateDecryptor(rijndaelManaged.Key, rijndaelManaged.IV);
        using (MemoryStream memoryStream = new MemoryStream(cipherText))
        &#123;
            using (CryptoStream cryptoStream = new CryptoStream(memoryStream, transform, CryptoStreamMode.Read))
            &#123;
                using (StreamReader streamReader = new StreamReader(cryptoStream))
                &#123;
                    result = streamReader.ReadToEnd();
                &#125;
            &#125;
        &#125;
    &#125;
    return result;

public static int Smth(string arg)
&#123;
    using (PowerShell powerShell = PowerShell.Create())
    &#123;
        try
        &#123;
            byte[] cipherText = Convert.FromBase64String(arg);
            string script = four.Decrypt2(cipherText, &quot;soooooo_sorry_zis_is_not_ze_flag&quot;);
            powerShell.AddScript(script);
            Collection&lt;PSObject&gt; collection = powerShell.Invoke();
            foreach (PSObject value in collection)
            &#123;
                Console.WriteLine(value);
            &#125;
        &#125;
        catch (Exception ex)
        &#123;
            Console.WriteLine(&quot;Exception received&quot;);
        &#125;
    &#125;
    return 0;
&#125;
</code></pre>
<p>虽然知道我们的钥匙经历了AES加密，Key是<code>soooooo_sorry_zis_is_not_ze_flag</code>，但IV未知（八成是输入的路线转换成的东西）。这时候，从CE看运行时内存，我们又会发现一些对其它指令的解码，且基本以function打头（如下是字节码放进赛博厨子烤的结果）：</p>
<pre><code>   function Invoke-MoveDirection($char, $room, $direction, $trailing) &#123;
    $nextroom = $null
    $movetext = &quot;You can&#39;t go $direction.&quot;
    $statechange_tristate = $null

    $nextroom = Get-RoomAdjoining $room $direction
    if ($nextroom -ne $null) &#123;
        $key = Get-ThingByKeyword $char &#39;key&#39;
        if (($key -ne $null) -and ($script:okaystopnow -eq $false)) &#123;
            $dir_short = ([String]$direction[0]).ToLower()

            $&#123;N&#125; = $&#123;sC`Ri`Pt:MS`VcRt&#125;::(&quot;&#123;1&#125;&#123;0&#125;&quot; -f&#39;nd&#39;,&#39;ra&#39;).Invoke()
</code></pre>
<p>这不就是我们在程序控制台里看到的东西吗？在这里，我们可以看到key的初定义，看到各种输出，甚至是——不对，上面那个不就是行动轮的代码吗？顺藤摸瓜找到全局变量direction的定义：</p>
<pre><code>$directions = @(&#39;n&#39;, &#39;north&#39;, &#39;s&#39;, &#39;south&#39;, &#39;e&#39;, &#39;east&#39;, &#39;w&#39;, &#39;west&#39;, &#39;u&#39;, &#39;up&#39;, &#39;d&#39;, &#39;down&#39;)
$directions_short = @&#123;&#39;n&#39; = &#39;north&#39;; &#39;s&#39; = &#39;south&#39;; &#39;e&#39; = &#39;east&#39;; &#39;w&#39; = &#39;west&#39;; &#39;u&#39; = &#39;up&#39;; &#39;d&#39; = &#39;down&#39;&#125;
$directions_enum = @&#123;&#39;n&#39; = 0; &#39;s&#39; = 1; &#39;e&#39; = 2; &#39;w&#39; = 3; &#39;u&#39; = 4; &#39;d&#39; = 5&#125;
$prepositions = @&#123;&#39;north&#39; = &#39;north of&#39;; &#39;south&#39; = &#39;south of&#39;; &#39;east&#39; = &#39;east of&#39;; &#39;west&#39; = &#39;west of&#39;; &#39;uu&#39; = &#39;above&#39;; &#39;down&#39; = &#39;below&#39;&#125;
</code></pre>
<p>很好，我们现在只需要在程序的静态资源里头找到一串只有0~5的序列就行了。dword列表一翻，很快的找，然后简单转换一下变成路线：</p>
<pre><code>way = &#39;30022111023022333540540540140240123540123123123123540&#39;
dir = &#39;nsewud&#39;
oput = &quot;&quot;
for i in way:
    oput += dir[ord(i) - 48]
print(oput)
</code></pre>
<p>按照路线走就会传送回大门，然后你的key变成了这样：</p>
<pre><code>&gt; l key
You can start to make out some words but you need to follow the RIGHT_PATH!@66696e646b6576696e6d616e6469610d0a // findkevinmandia
</code></pre>
<p>好，这就去找Kevin。不过在此之前，这里还有一个函数——</p>
<pre><code>function Invoke-Say($char, $room, $trailing) &#123;
    $resp = &quot;It doesn&#39;t talk back&quot;

    $ar = $trailing.Split()
    if ($ar.Length -lt 2) &#123;
        return &quot;Syntax: say &lt;someone&gt; &lt;words...&gt;&quot;
    &#125;

    $to_whom = $ar[0]
    $words = $ar[1..99999]

    $thing = Get-ThingByKeyword $room $to_whom
    if ($thing.Name -eq &quot;Kevin Mandia&quot;) &#123;
        $resp = &quot;Kevin says a friendly &#39;hello&#39; and then looks back down at his computer. He&#39;s busy turbo-hacking.&quot;

        $key = Get-ThingByKeyword $room &#39;key&#39;

        $helmet = $null
        foreach ($thing in $char.Wearing) &#123;
            if ($thing.Keywords -contains &quot;helmet&quot;) &#123;
                $helmet = $thing
            &#125;
        &#125;

        if (($key -ne $null) -and ($helmet -ne $null)) &#123;
            $md5 = New-Object System.Security.Cryptography.MD5CryptoServiceProvider
            $utf8 = New-Object System.Text.UTF8Encoding
            $hash = [System.BitConverter]::ToString($md5.ComputeHash($utf8.GetBytes($key.Desc)))


            $Data = [System.Convert]::FromBase64String(&quot;EQ/Mv3f/1XzW4FO8N55+DIOkeWuM70Bzln7Knumospan&quot;)
            $Key = [System.Text.Encoding]::ASCII.GetBytes($hash)

            # Adapated from the gist by harmj0y et al
            $R=&#123;$D,$K=$Args;$H=$I=$J=0;$S=0..255;0..255|%&#123;$J=($J+$S[$_]+$K[$_%$K.Length])%256;$S[$_],$S[$J]=$S[$J],$S[$_]&#125;;$D|%&#123;$I=($I+1)%256;$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bxor$S[($S[$I]+$S[$H])%256]&#125;&#125;
            $x = (&amp; $r $data $key | ForEach-Object &#123; &quot;&#123;0:X2&#125;&quot; -f $_ &#125;) -join &#39; &#39;
            $resp = &quot;`nKevin says, with a nod and a wink: &#39;$x&#39;.&quot;
            $resp += &quot;`n`nBet you didn&#39;t know he could speak hexadecimal! :-)&quot;
        &#125;
    &#125;

    return $resp
&#125;
</code></pre>
<p>看样子我们得在完成一系列步骤后去老板办公室把头盔带上，再把key撇了。于是我们照做试试看：</p>
<pre><code>&gt; get helmet
You get A football helmet.

&gt; wear helmet
You put the helmet on your head. It looks objectively awesome.

&gt; drop key
You drop a key

&gt; say kevin hi

Kevin says, with a nod and a wink: &#39;6D 75 64 64 31 6E 67 5F 62 79 5F 79 30 75 72 35 33 6C 70 68 40 66 6C 61 72 65 2D 6F 6E 2E 63 6F 6D&#39;.

Bet you didn&#39;t know he could speak hexadecimal! :-)
</code></pre>
<p>flag到手！</p>
<blockquote>
<p>flag{<a href="mailto:&#x6d;&#117;&#x64;&#x64;&#49;&#110;&#103;&#95;&#x62;&#121;&#x5f;&#x79;&#x30;&#x75;&#x72;&#x35;&#51;&#x6c;&#112;&#x68;&#64;&#x66;&#108;&#x61;&#x72;&#x65;&#45;&#111;&#x6e;&#46;&#99;&#x6f;&#x6d;">&#x6d;&#117;&#x64;&#x64;&#49;&#110;&#103;&#95;&#x62;&#121;&#x5f;&#x79;&#x30;&#x75;&#x72;&#x35;&#51;&#x6c;&#112;&#x68;&#64;&#x66;&#108;&#x61;&#x72;&#x65;&#45;&#111;&#x6e;&#46;&#99;&#x6f;&#x6d;</a>}</p>
</blockquote>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">CTF</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2024/03/29/FlareOn4%E5%81%9A%E9%A2%98%E5%90%88%E9%9B%86/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-从2023-XCTF-finals的一道逆向题目来看pythonC程序的拆包" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2024/03/29/%E4%BB%8E2023-XCTF-finals%E7%9A%84%E4%B8%80%E9%81%93%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AE%E6%9D%A5%E7%9C%8BpythonC%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8B%86%E5%8C%85/">从2023 XCTF finals的一道逆向题目来看pythonC程序的拆包</a>
    </h1>
  

        
        <a href="2024/03/29/%E4%BB%8E2023-XCTF-finals%E7%9A%84%E4%B8%80%E9%81%93%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AE%E6%9D%A5%E7%9C%8BpythonC%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8B%86%E5%8C%85/" class="archive-article-date">
  	<time datetime="2024-03-29T12:30:10.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2024-03-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>题目为XCTF2023的“我不是病毒2.0”</p>
</blockquote>
<p>die查看，发现是个拟态C++，实际上是个python3.10程序，万幸它没用3.11，遂直接用pyinstxtractor和pycdc跟它爆了。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BXctf%5DIm_not_virus_pic1.png"></p>
<p>具体怎么爆可以看<a target="_blank" rel="noopener" href="https://www.fortinet.com/blog/threat-research/unpacking-python-executables-windows-linux">fortinet上的教程</a>、一篇<a target="_blank" rel="noopener" href="https://0xec.blogspot.com/2017/02/extracting-encrypted-pyinstaller.html">有关解码加密pyc的文章</a>，以及<a target="_blank" rel="noopener" href="https://sakura520.life/post/8be8.html">Redamancy的博客</a>。第一步肯定还是尝试使用pyinstxtractor拆解exe文件，但当你拆解完成之后，你会发现主函数对一个 意⭐义⭐不⭐明 的pyc进行调用：</p>
<pre><code>import sign
sign.main()
</code></pre>
<p>这意味着源代码其实是在解压出的pyc包中的这个自定义pyc模块：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BXctf%5DIm_not_virus_pic2.png"></p>
<p>但是怎么解码呢？我们得先明白，这个python程序是如何打包的，以及为什么会出现这样的加密数据：</p>
<h3 id="python程序的打包"><a href="#python程序的打包" class="headerlink" title="python程序的打包"></a>python程序的打包</h3><p>（资料参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33934427/article/details/129152909">王小希ww 的博客</a>和<a target="_blank" rel="noopener" href="https://www.cnblogs.com/weilaiqinkong/p/17240065.html">琴声悠悠-悠悠琴声 的博客</a>）</p>
<p>目前python程序的打包方式主要是通过PyInstaller或setupTools来实现的。前者是将python文件及其调用模块打包成一个可执行文件（exe&#x2F;elf），后者则是将其作为python用的软件包打包，并发布到PyPI或者其它软件包管理器中，作为其它python程序的调用库被下载和使用。当然，你也可以选择直接拷贝一份你的运行环境并写一个启动程序，不过，这种方法的稳定性、高效性和安全性就取决于你的代码能力和肝度了（笑</p>
<p>关于pyinstaller打包命令参数如下：</p>
<blockquote>
<p>-w 表示希望在生成的.exe程序运行过程中，不要出现cmd黑框，一般用于打包GUI界面</p>
<p>-F：表示希望将所有的程序全部打包在一起，生成的只有一个.exe文件，这样的文件集成度高，但是运行速度慢<br>（如果不写-F，生成的还有一堆.dll文件，这样的程序里文件很多，但是运行速度比较快）</p>
<p>-D：生成一个文件目录包含可执行文件和相关动态链接库和资源文件等<br>（对于打包结果较大的项目，选用-d生成目录相比单可执行文件的打包方式，执行速度更快，但包含更加多的文件）</p>
<p>-p：自定义需要加载的类的路径</p>
<p>-i：自己做的软件可以放上自己的图标，分享一个网站，可以把其他格式图片转成ico格式</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BXctf%5DIm_not_virus_pic3.png"></p>
<p>需要注意的是，被打包的python文件在import某个包内的其它模块的时候，需要添加调用包的根目录名，或者将被调用模块的根目录打包成一个新包，否则会因为找不到调用模块而报错。</p>
<p>而我们看到的这一个程序，明显是-F指令生成的集成程序。至于为什么使用pyinstxtractor解包后看到的调用包是一堆encrypted的包，是因为pyinstaller还可以使用特定的key参数对代码进行AES加密，比方说：</p>
<pre><code>pyinstaller --key 123 demo.py
</code></pre>
<p>但实际上，这个加密有个致命的弱点，那就是存放key的<code>pyimod00_crypto_key</code>，以及入口函数<code>main.py</code>并没有加密。这样，我们的目标库和加密key简直就是开盖即食。于是先用pycdc反编译一下key，然后用代码解pyc加密的同时加上一下文件头，最后用pycdc处理一手：</p>
<pre><code>import tinyaes
import zlib
CRYPT_BLOCK_SIZE = 16
# 从pyimod00_crypto_key里把key拽出来
key = bytes(&#39;HelloHiHowAreYou&#39;, &#39;utf-8&#39;)
inf = open(&#39;./PYZ-00.pyz_extracted/sign.pyc.encrypted&#39;, &#39;rb&#39;) # encrypted file input
outf = open(&#39;sign.pyc&#39;, &#39;wb&#39;) # output file
# 代码块就这么长，能AES的不多，先初始化一手
iv = inf.read(CRYPT_BLOCK_SIZE)
cipher = tinyaes.AES(key, iv)
# 解码并解压
plaintext = zlib.decompress(cipher.CTR_xcrypt_buffer(inf.read()))
# 写入pyc文件头
outf.write(b&#39;\x6f\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0&#39;)
# 写入解码过的pyc
outf.write(plaintext)

inf.close()
outf.close()
</code></pre>
<p>最后爆出来这一坨：</p>
<pre><code>import hashlib as 沈阳
import base64 as 杭州
import ctypes as 蚌埠

def main():
    蚌埠.windll.kernel32.VirtualAlloc.restype = 蚌埠.c_void_p
    福建 = input(&#39;您的输入：&#39;)
    天津 = &#39;9K98jTmDKCXlg9E2kepX4nAi8H0DB57IU57ybV37xjrw2zutw+KnxkoYur3IZzi2ep5tDC6jimCJ7fDpgQ5F3fJu4wHA0LVq9FALbjXN6nMy57KrU8DEloh+Cji3ED3eEl5YWAyb8ktBoyoOkL1c9ASWUPBniHmD7RSqWcNkykt/USjhft9+aV930Jl5VjD6qcXyZTfjnY5MH3u22O9NBEXLj3Y9N5VjEgF2cFJ+Tq7jj92iIlEkNvx8Jl+eH5/hipsonKLTnoLGXs4a0tTQX/uXQOTMBbtd70x04w1Pa0fp+vA9tCw+DXvXj0xmX8c5HMybhpPrwQYDonx7xtS+vRIj/OmU7GxkHOOqYdsGmGdTjTAUEBvZtinOxuR7mZ0r9k+c9da0W93TWm5+2LKNR6OJjmILaJn0lq4foYcfD5+JITDsOD6Vg01yLRG1B4A6OxJ7Rr/DBUabSu2fYf1c4sTFvWgfMV8il6QfJiNMGkVLey1cBPSobenMo+TQC1Ql0//9M4P01sOiwuuVKLvTyDEv6dKO//muVL9S2gq/aZUBWkjj/I5rUJ6Mlt4+jsngmuke9plAjw22fUgz+8uSzn40dhKXfBX/BOCnlwWsMGAefAfoz/XAsoVSG2ioLFmlcYe/WBgaUJEoRUSyv73yiEOTVwIK6EPnDlwRgZZHx2toLu8udpEZ0aKGkex5sn7P8Jf9AbD4/EiQU+FdoJSxGorPSZGvrc4=&#39;
    北京 = 沈阳.md5(&#39;云南&#39;.encode(&#39;utf-8&#39;)).hexdigest()
    重庆 = 杭州.b64decode(天津)
    河南 = b&#39;&#39;
    北京_len = len(北京)
    广州 = list(range(256))
    j = 0
    for i in range(256):
        j = (j + 广州[i] + ord(北京[i % 北京_len])) % 256
        广州[i] = 广州[j]
        广州[j] = 广州[i]
    山东 = 陕西 = 0
    for 河北 in 重庆:
        山东 = (山东 + 1) % 256
        陕西 = (陕西 + 广州[山东]) % 256
        广州[山东] = 广州[陕西]
        广州[陕西] = 广州[山东]
        河南 += bytes([
            河北 ^ 广州[(广州[山东] + 广州[陕西]) % 256]])
    四川 = 蚌埠.create_string_buffer(福建.encode())
    黑龙江 = 蚌埠.windll.kernel32.VirtualAlloc(蚌埠.c_int(0), 蚌埠.c_int(len(河南)), 蚌埠.c_int(12288), 蚌埠.c_int(64))
    蚌埠.windll.kernel32.RtlMoveMemory(蚌埠.c_void_p(黑龙江), (蚌埠.c_ubyte * len(河南)).from_buffer(bytearray(河南)), 蚌埠.c_size_t(len(河南)))
    辽宁 = 蚌埠.windll.kernel32.CreateThread(蚌埠.c_int(0), 蚌埠.c_int(0), 蚌埠.c_void_p(黑龙江), 蚌埠.byref(四川), 蚌埠.c_int(0), 蚌埠.pointer(蚌埠.c_int(0)))
    蚌埠.windll.kernel32.WaitForSingleObject(蚌埠.c_int(辽宁), 蚌埠.c_int(-1))
    if 四川.raw == b&#39;\xdb\x1b\x00Dy\\C\xcc\x90_\xca.\xb0\xb7m\xab\x11\x9b^h\x90\x1bl\x19\x01\x0c\xeduP6\x0c0\x7f\xc5E-L\xb0\xfb\xba\xf6\x9f\x00&#39;:
        print(&#39;是的！你得到了！&#39;)
        return None
    None(&#39;不，再尝试更多。 （笑脸符号）&#39;)

if __name__ == &#39;__main__&#39;:
    main()
    return None
</code></pre>
<p>虽然加了一堆的中文混淆，但是，基本逻辑还是比较清晰的。不过有个坏消息，这又是一道密码题，它先以“云南”为key生成S盒，然后直接跑一个浅显的RC4（详情请见<a target="_blank" rel="noopener" href="https://blog.csdn.net/u011377996/article/details/85221508">0verWatch 的博客</a>），把一份shellcode解密完再开一个子进程运行。虽然初见看的我两眼一黑，但我有wp（</p>
<p>我们先直接进行一个RC4的解：</p>
<pre><code>from Crypto.Cipher import ARC4
import hashlib
import base64

天津 = b&#39;9K98jTmDKC...
北京 = hashlib.md5(&#39;云南&#39;.encode(&#39;utf-8&#39;)).hexdigest()
北京 = bytes(北京.encode(&#39;utf-8&#39;))
重庆 = base64.b64decode(天津)
天津 = ARC4.new(北京)
output = 天津.decrypt(bytes(重庆))
print(list(output))
</code></pre>
<p>然后得到的东西像原代码一样，我们之前也见过类似的东西，也就是数据层藏代码然后放到子进程运行，只不过这里是在python上调用的C库。但是接下来的事情直接用C就成，开个虚拟栈帧+子进程把shellcode弄出来（参考<a target="_blank" rel="noopener" href="https://su-team.cn/passages/2023-03-29-XCTFfinals/">SU战队的题解</a>）：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;Windows.h&gt;

unsigned char shellcode[] = &#123;
    81, 232, 0, 0, 0, 0...
&#125;;

int main() &#123;
    PVOID p = VirtualAlloc(NULL, sizeof(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    memcpy(p, shellcode, sizeof(shellcode));
    ((void(__stdcall*)())(p))();
    return 0;
&#125;
</code></pre>
<p>然后我们从ida里可以看到它本来的样子……的一部分。虽然你第一遍可能看不明白它为什么会高位截瘫，你甚至找不到一个return，还得自己补一个。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BXctf%5DIm_not_virus_pic4.png"></p>
<p>但我们至少得让这里面的东西解出来再说。我们通过刚才强行凑函数的结果可以看到，这玩意其实在对后面那段shellcode进行解密，尤其是在动调一遍后，这一段尤其明显：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BXctf%5DIm_not_virus_pic5.png"><br><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BXctf%5DIm_not_virus_pic6.png"></p>
<p>等下，这不是解密完了吗？我们直接create function然后f5进去看一眼：</p>
<pre><code>_WORD *sub_1D0162()
&#123;
  _WORD *result; // rax
  unsigned int v1; // [rsp-1Ch] [rbp-1Ch]
  unsigned int v2; // [rsp-14h] [rbp-14h]
  unsigned int v3; // [rsp-10h] [rbp-10h]
  int i; // [rsp-Ch] [rbp-Ch]
  __int64 v5; // [rsp-8h] [rbp-8h]

  for ( i = 0; i &lt;= 20; ++i )
  &#123;
    v2 = 2029;
    v3 = *(unsigned __int16 *)(2i64 * i + v5) % 0xD1EFu;
    v1 = 1;
    while ( v2 )
    &#123;
      if ( (v2 &amp; 1) != 0 )
        v1 = v3 * v1 % 0xD1EF;
      v3 = v3 * v3 % 0xD1EF;
      v2 &gt;&gt;= 1;
    &#125;
    result = (_WORD *)(2i64 * i + v5);
    *result = v1;
  &#125;
  return result;
&#125;
</code></pre>
<p>好家伙，算法直接看完了。就是把数据两个两个提出来（因为是int16且i*2的提法）于是我们直接数据提出来，写脚本开爆：</p>
<pre><code>·python part
---------------
output = []
str1 = &#39;\xdb\x1b\x00D...
for i in str1:
    output.append(ord(i))
print(output)

·C++ part
---------------
#include &lt;iostream&gt;
#define modnum 0xD1EFu
using namespace std;

unsigned char cipher[] = &#123;219, 27, 0, 68...

int main()
&#123;
    for(unsigned int i=0;i&lt;=20;++i)&#123;
        int laztag = 0;  // 爆出即停用标记 
        unsigned int cip = (cipher[i*2] + (cipher[i*2+1]&lt;&lt;8)) % modnum;
        for(unsigned int j=0;j&lt;127;j++)&#123;
            for(unsigned int k=0;k&lt;127;k++)&#123;  // 暴力枚举每一个可能字符 
                unsigned int key = 2029;
                unsigned int guess = (j + (k&lt;&lt;8)) % modnum;
                unsigned int v1 = 1;
                while(key)&#123;  // 还原算法 
                    if(key &amp; 1 != 0)
                        v1 = guess * v1 % modnum;
                    guess = guess * guess % modnum;
                    key &gt;&gt;= 1;
                &#125;
                if(v1 == cip)&#123;  // 猜对了 
                    printf(&quot;%c%c&quot;,j,k);
                    laztag = 1;
                    break;
                &#125;
            &#125;
            if(laztag == 1)break; // 爆出即停，节约算力 
        &#125;
    &#125;
&#125;
</code></pre>
<p>做个总结：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%5BXctf%5DIm_not_virus_pic7.png"></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">CTF</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2024/03/29/%E4%BB%8E2023-XCTF-finals%E7%9A%84%E4%B8%80%E9%81%93%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AE%E6%9D%A5%E7%9C%8BpythonC%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8B%86%E5%8C%85/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-深入理解计算机系统学习笔记-第五篇（下）" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/09/16/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E4%BA%94%E7%AF%87%EF%BC%88%E4%B8%8B%EF%BC%89/">深入理解计算机系统学习笔记-第五篇（下）</a>
    </h1>
  

        
        <a href="2023/09/16/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E4%BA%94%E7%AF%87%EF%BC%88%E4%B8%8B%EF%BC%89/" class="archive-article-date">
  	<time datetime="2023-09-16T07:48:43.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-09-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>终于，到了大三</p>
<p>估计不久之后也要开始崩溃的考研时光了（悲</p>
<p>那么接下来，开始我的炸弹秀——</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%8B-1.png"></p>
<p>啊对对对，是咋俩的炸弹秀。</p>
<h3 id="讲到哪了？"><a href="#讲到哪了？" class="headerlink" title="讲到哪了？"></a>讲到哪了？</h3><p>哦，对了，上一回刚刚讲到子进程和fork，其中提到了一些：</p>
<h3 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h3><p>我们之前提到的<code>SIGSTOP / SIGSTEP / SIGTTIN / SIGTTOU</code>信号，其实只是信号的一部分。信号的定义，实际上就是内核向进程系统发送的消息，提示系统进程发生了，或者计划发生某些事件。比方说一个进程可以通过内核发送向另一个进程的<code>SIGKILL</code>信号，来终止目标进程；再比如内核发出<code>SIGXCPU</code>信号的时候，是一个进程TLE（Time Limit Exceed，运行超时，准确来讲是在CPU中执行指令的时候并没有抛出异常却卡住了）了。</p>
<p>至于这些信号的确切作用，你可以在《深入理解》的原书中找到，本文不再赘述。</p>
<h4 id="信号的运作"><a href="#信号的运作" class="headerlink" title="信号的运作"></a>信号的运作</h4><p>既然提到信号，那么就不得不提信号的收发。概念很简单，<strong>发送信号</strong>就是内核将信号发送到进程，<strong>接收信号</strong>就是进程对内核发出的信号做出反应（并且因为内核的层级高于进程，实际上在通常情况下，这个接受过程是<strong>受迫</strong>的）。</p>
<p>是否发送取决于内核是否对检测到的系统事件进行反应，或者说系统有没有收到来自进程的kill请求。最直观的就是当你的程序卡住不动，尝试操作又导致超时的时候，windows任务管理器会发来一个提示，让你决定是否中断程序，当你选择中断，那么内核才会对这个异常信号反应，或者接受kill的调用请求，选择继续等待时则会绕过这一次的决策。</p>
<p>同样的，有无法发送的情况，就有无法接收的情况。有被动的情况，一个发出但没有被接收的信号叫<strong>待处理信号</strong>，一旦一个进程有一条对应的待处理信号，那么与这条信号同类的所有信号都会在传入的时候被拦截，而这也就意味着，待处理信号有对于当前进程的<strong>唯一性</strong>，即一个进程的同一类待处理信号只能有一个。</p>
<p>也有主动的情况，就是一个进程可以选择<strong>阻塞</strong>某类信号，这些被阻塞的信号会处于一种“如收”的状态，即收了但没执行，直到进程取消阻塞行为。实际上，对于待处理信号的处理过程就是一种<strong>隐式</strong>的阻塞，相对而言，使用**<code>sigporcmask</code><strong>函数之类的手段进行调用的阻塞则是</strong>显式**阻塞，具体而言可以翻阅《深入理解》原书522到533页，本文不再赘述。</p>
<p>内核在每个进程中维护两个分别叫”<strong>pending</strong>“和”<strong>blocked</strong>“的位向量，一个维护当前进程的待处理信号，一个维护被阻塞的信号类别.当内核发送一个信号给进程时，它将会修改进程的pending位向量，譬如说，当内核发送一个<code>SIGINT</code>信号给进程，那么它会将进程的<code>pending[SIGINT]</code>的值设置成1。同样地，当进程屏蔽掉一个信号时，那么它会修改blocked位向量。实际上，比起将其当作向量理解，学OI学多的人更可能会将其当作bool数组来理解，不过这都是后话了。</p>
<h4 id="发信与收信的方式"><a href="#发信与收信的方式" class="headerlink" title="发信与收信的方式"></a>发信与收信的方式</h4><p>虽然我很想先把发信方式讲了，但是，我突然意识到，我在介绍进程的时候漏了个概念：</p>
<h4 id="进程和进程组"><a href="#进程和进程组" class="headerlink" title="进程和进程组"></a>进程和进程组</h4><p>众所周知，每个进程有唯一对应的编号，但是，打过OI或者学过数据结构的人应该明白，对于大批量且具有明确上下级关系的结构，用并查集维护（简单来讲就是对于在同一个连通块的数据，全部归为一组进行管理，方便对组数据的批处理操作）往往比直接用数组更为高效。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%8B-2.png"></p>
<p>行行行，考虑到大家都是学CTF的，不谈OI了，谈数据结构吧。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%8B-3.png"></p>
<p>就单纯为了方便管理，在进程之上，还有<strong>进程组</strong>的概念，即父进程以及所有与之直接或间接关联的子进程。众所周知，是个并查集都需要一个单射序列，来确定所有的集合。同样地，进程组也需要一个唯一对应的标识，也就是**进程组ID(PGID)**。当一个新的进程组产生，其进程组ID往往是其根进程，也就是第一个加入该进程组的进程的PID。</p>
<p>一个进程对自身所在的进程组，可以用**<code>getpgrp</code><strong>进行查询，也可以用</strong><code>set-pgid</code>**函数来更改自身或其它进程的进程组，set-pgid若设定pgid为0，则以目标进程为根进程，新创建一个进程组。</p>
<h4 id="回到正题"><a href="#回到正题" class="headerlink" title="回到正题"></a>回到正题</h4><p>发信的方式有很多，**<code>/bin/kill</code>** 程序或者编程语言中系统库的kill函数，可以向任意进程发送<code>SIGKILL</code>，也就是所谓“杀程序”的信号；系统快捷键也可以向正在运行中的进程发送信号，比方说在运行时 <strong>Ctrl+C</strong> 就是发送强制终止的信号；进程也可以通过调用alarm函数给自己发送<code>SIGALRM</code>信号，etc。</p>
<p>信号的收发，论其根源实际上都是内核到进程的单线控制。当内核完成上下文切换或者从系统调用中返回进程时，控制权由内核移交给进程，此时，若我们之前提到的，内核维护的待处理信号集合&#x2F;序列为非空状态，内核会根据序列中信号在系统中编号的大小，从小到大发送信号。进程在接收信号，完成行为之后就继续执行下一条指令——如果它没有被信号影响而产生一些无法逆转的后果的话。</p>
<p>进程在接收信号的时候可以通过 <strong><code>signal</code></strong> 函数来改变某类信号相关联的行为。简单来讲，如之前所说，每一个信号种类其实对应着序列上的一个元素，而这个元素又与一条编码序列，也就是 <strong>信号编码</strong> 形成单射，signal就是将编码对应的信号调用转移到其它函数，或者将它已经变更过的调用转移到原信号上。</p>
<p>举个并不很实际，但却很直观的例子，假设今天小娜想特别给自己插张全新N卡，她的<code>SIGUSR1(允许用户自定义的信号)</code>被设定为自己的导航程序的启动函数：</p>
<pre><code>signal(10, *loc_tar_start);
</code></pre>
<p>这时候，她的思考进程捕获到了<code>SIGUSR1</code>信号，启动了导航程序，让她能够一路畅通无阻的杀向电子城。但是，她盘算了自己的钱包，显然连这个月给自己充电用的电费都快付不起了。她只好想着法子克制自己的欲望，于是她灵机一动，把代码改成了这个样子：</p>
<pre><code>sighandler_t signal(10, SIG_IGN);
</code></pre>
<p>当第二个参数为<code>SIG_IGN</code>时，<code>SIGUSR1</code>会被忽略，这样她就找不到地，也就用一个非常简单的方式保住了自己的钱包。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%8B-4.png"></p>
<p>好吧，下回给你多发点……</p>
<p>不过，如果想要达到忽略信号的效果，阻塞其实也不失为一种办法，这就要利用 <strong><code>sigporcmask</code></strong> 函数了。</p>
<h3 id="非本地跳转"><a href="#非本地跳转" class="headerlink" title="非本地跳转"></a>非本地跳转</h3><p>当然，并不是只有内核才能处理异常，异常也不是只提供给内核的操作手段。<strong>非本地跳转</strong>通过**<code>setjump</code><strong>和</strong><code>longjump</code>**函数，提供了令用户层不需要通过内核，便能在进程间转移的手段。</p>
<p><code>setjump</code>通过在栈上的<strong>env缓冲区</strong>保存当前<strong>调用环境</strong>，也就是在栈上某个可用区域存储你目前用到的运行环境相关的变量，包括程序的计数器、栈指针和通用目的寄存器。而<code>longjump</code>负责从env缓冲区中恢复这些状态。具体实例还是得翻阅原书，毕竟这里只是个笔记，抛砖引玉用的。</p>
<hr>
<p>综上所述，我们终于大概弄明白了整一个进程操作和控制流传递的过程，也大致明白了你的计算机究竟是怎样在多个问题中思考，寻求解决方案的。不出意外，下一期，我们就要去干内存了。所以……</p>
<p><em><strong>–ARE YOU READY???–</strong></em></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">学习</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/09/16/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E4%BA%94%E7%AF%87%EF%BC%88%E4%B8%8B%EF%BC%89/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-深入理解计算机系统学习笔记-第四篇（下）" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%8B%EF%BC%89/">深入理解计算机系统学习笔记-第四篇（下）</a>
    </h1>
  

        
        <a href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%8B%EF%BC%89/" class="archive-article-date">
  	<time datetime="2023-09-09T07:15:03.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-09-09</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="上回书说到"><a href="#上回书说到" class="headerlink" title="上回书说到"></a>上回书说到</h3><p>还上回书啥呢，趁热打铁，给大家来点想看的东西——存储结构的机器级表示。</p>
<p>至于小娜……我安排她帮我过旷野之息的进度去了，这会估计还在跟远古机械斗智斗勇吧（笑），等我投个屏……</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B1.jpg"></p>
<p>希望她新装的自动躲避系统没事……希望如此</p>
<h3 id="回到正题——机器层面的数组"><a href="#回到正题——机器层面的数组" class="headerlink" title="回到正题——机器层面的数组"></a>回到正题——机器层面的数组</h3><p>我们已经不止一次提过数组的概念，熟悉程序逆向或者计算机工程的同学应该明白，包括之前提过不止一遍，内存可以视为一个大的数组。而这个数组的<strong>元素</strong>，最小单位就是字节。我们每次实际开的数组，都是取这个大数组中的一部分，再按我们需求的数据的<strong>单位长度</strong>进行元素的划分，比如我们开一个int数组就是每4字节为一个元素，etc。</p>
<p>也因此，数组所需要与<strong>索引</strong>对应的地址的抽象概念，也就是<strong>指针</strong>，也是严格按照这种单位的运算模式来进行数据的索引的。指针的运动和指向，严格取决于你所定义的数据类型。</p>
<p><em>ps.指针也可以被指向函数</em></p>
<p>故我们需要面对的实际数组，理所应当的，每一个元素都对应着两个信息，一个是它本体存储的信息，另一个是其存储地址。而对于一个指针变量而言，如果需要在这些元素间跳转，其实也很简单，只需要搞到这个数组的起始地址，然后按照我们设定的单位长度，进行指针的累加或累减，运算表达式大致为(^*(E+N))（E为数组起始地址，N为索引）的格式。其地址则是起始地址+偏移量的格式，偏移量为索引值和数据单位长度的乘积。</p>
<p>比方说我们想要搞到int数组ans的索引为2的元素，在高级语言层面我们使用<code>int a = ans[2]</code>，而在汇编层面，我们取<code>mov (%rdi,%rdx,4) %rax</code>即可，最低维索引值在rdx，而数组本体的地址在rdi中。从上述运算也可见，指针是依照其单位长度，而非最基础的单字节来增加或减少的。</p>
<h4 id="数组嵌套"><a href="#数组嵌套" class="headerlink" title="数组嵌套"></a>数组嵌套</h4><p>就算是使用数组嵌套也是一个道理，只不过，原本M维的索引放到内存空间统统降维打击，指针也给你压缩成(<em>(E+N_1</em>N_{2max}+N_2*N_{3max}+……+N_{M-1}*N_{Mmax}+N_M))的格式。简单来讲，和原来的理解方式一样，嵌套数组不过是把上一维数组的单位元素变成了下一维的数组，但实现起来可能就有点让人抓狂，比方说逆向的地图题。</p>
<p>而具体而言，例如int二维数组<code>M[x][y]</code>，x、y为常数，每个元素的地址都变成了诸如(&amp;M[i][j]&#x3D;M+L(y*i + j), L&#x3D;sizeof(int))的格式，二维数组被横向拉长成数个单位数组的拼接，而每个元素的索引值又是其所在的单位数组的索引+在所在单位数组中元素的索引，如下图：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B2.jpg"></p>
<p>此时，两个维度的索引值分别在rsi和rdx中，数组本体的地址在rdi中。调用的时候，比方说我们需要调用<code>M[2][2]</code>，我们需要这么做：</p>
<pre><code>lea (,%rsi,y) %rax //确定第一维的值i=2，令rax指向地址2y
lea (%rdi,%rax,4) %rax //令rax指向地址(M+4(2y))
mov (%rax,%rdx,4) %eax //引入第二维的值j=2，将地址(M+4(2y+2))的数据提至eax寄存器
</code></pre>
<p>整体过程大概就是：通过指针计算地址——&gt;指向地址上的元素——&gt;将元素提取出来。</p>
<p>包括在循环过程中也是如此，遍历同一维度时，我们只需要对地址进行<code>add $4 %rax</code>，而遍历上一级维度，也只需要进行<code>lea (%rax,y,4) %rax</code>即可。</p>
<p><em>ps.这里直接写y是为了更加直观，实际y可能存放于另一个寄存器中</em></p>
<h4 id="变长数组"><a href="#变长数组" class="headerlink" title="变长数组"></a>变长数组</h4><p>包括长度随变量而变化的数组也逃不开这个过程。只是由于涉及到了更多的变量，我们不得不使用耗费更多算力的mul指令来计算地址，而不能再简单地通过表达式赋值。比方说倘若我们的M数组是一个大小为n*n的矩阵，rcx被赋值为n，则其元素调用方法变更如下：</p>
<pre><code>imul %rsi %rcx //确定第一维的值i=2，同时指针参数赋值2n
lea (%rdi,%rcx,4) %rax //令rax指向地址(M+4(2n))
mov (%rax,%rdx,4) %eax //引入第二维的值j=2，将地址(M+4(2n+2))的数据提至eax寄存器
</code></pre>
<h4 id="编译优化"><a href="#编译优化" class="headerlink" title="编译优化"></a>编译优化</h4><p>但是，就像小娜不想算加密，编译器也不想给自己太大的负担，这样对开发者的血压也有好处。于是，一般对于定长数组，C语言优化等级为o1时会将源代码中的指定长度define为常量，这样调用数组长度就只需要调用这个常量，而不是四处乱放的立即数。譬如我们定义<code>int M[10][10]</code>时,系统就会自动加上:</p>
<pre><code>#define N 10
typedef int M[N][N];
</code></pre>
<hr>
<h3 id="其它类型的存储结构"><a href="#其它类型的存储结构" class="headerlink" title="其它类型的存储结构"></a>其它类型的存储结构</h3><h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>如果数组还是个单位元素定长的数据结构，那C的<strong>结构体</strong>就是完完全全地随意发挥了。虽然还遵循着地址为起始地址+偏移量的标准，但内存空间的分配则是顺序的，按照你对结构体的定义分配，并且，偏移量也是不同数据类型的组合。就比如说你想要调用如下结构体中的数组中的第i个元素：</p>
<pre><code>struct rec&#123;		//beginning address in rdi
    int i
    char j
    int a[6]	//i in rsi
    int *p
&#125;cal; 
</code></pre>
<p>那它的内存引用值大概就是(4+1)(%rdi,%rsi,4)，即提前计算好的立即数+数组指针对应的地址偏移……吗？</p>
<p>我们思维中就是如此，但计算机可不一定这么想。因为惯例上，不同数据类型的数据的地址，应当是其数据单位长度的整数倍。所以，对于这么一堆int中混入的char，编译器自然是对其进行填充处理，即自动填充一个长度为3的空隙。于是，实际的内存引用值就是8(%rdi,%rsi,4)。这个填充值会根据你实际定义的数据类型，数据的排列方式和硬件系统的操作数来进行变化。</p>
<h4 id="联合"><a href="#联合" class="headerlink" title="联合"></a>联合</h4><p>我们联合！！！（逃</p>
<p>如上，struct的构建方式会带来一个严重的问题，如果我们大量使用具有惯例上导致空间冲突的不同数据类型的结构体，那么，其产生的内存占用将会是灾难级的。如果我们想减少数据分配空间，避免爆内存，我们在开发中会不可避免地用上<strong>联合体</strong>（虽然我都没用过）。</p>
<p>联合体的所有数据共享同一存储空间，其大小取决于其最大字段的大小，比如说上面那个struct，如果我们把它改成union：</p>
<pre><code>union rec&#123;		//beginning address in rdi
    int i
    char j
    int a[6]	//i in rsi
    int *p
&#125;cal; 
</code></pre>
<p>于是乎，原本需要&#x2F;(4+(1+3)+6<em>4+8&#x2F;)字节空间的数据，只需要6</em>4个字节就可以存下了。这种结构经常用于需要拓展子节点的树形结构等，并且，不知可以单独运用，你还可以在struct里套union，或者反过来套，防止内存溢出漏洞的同时也可以节省空间，就比如一个二叉树，你需要记录它的状态和左右子节点，那你就可以这么写来节省空间：</p>
<pre><code>union node_t&#123;
    struct&#123;
        struct node_t *left;
        struct node_t *right;
    &#125;
    char status;
&#125;inf;
</code></pre>
<p>又比如，你想要完成数据转换，但又不希望强制数据转换带来的二进制位出错，你就可以使用union，创造一个可以以一种数据类型存储，另一种来访问的方法，也就是《深入理解》原书中188页提及的部分，本文不再赘述。</p>
<hr>
<h3 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a>缓冲区溢出</h3><p>准确来讲，这一块内容应当叫“内存越界引用和缓冲区溢出”，但各路博主对于溢出漏洞及其利用，所引用的名词都非常的多元化，就按下不表了。</p>
<p>C语言对于数组引用没有边界检查，对越界的数组元素进行写操作，就会导致栈中信息被修改，进行读操作就会导致程序中的一些不知名数据被读取。这个情况在pwn中非常明显，就比如经典的gets漏洞和printf漏洞，我们就可以通过写字符串来覆盖掉短小的字符串类型数据之外的一些指令。譬如如下代码：</p>
<pre><code>void input()
&#123;
    char buf[8];
    read(0, buf, 0x50);
    printf(buf);
    return;
&#125;
void cat_flag()
&#123;
    system(&quot;cat flag&quot;);
&#125;
int main()
&#123;
    input();
    return 0;
&#125;

in linux assemble（省略堆栈平衡部分）:
input:
    mov     edx, 50h
    mov     rsi, rbx
    mov     edi, 0
    call    _read
    mov     rdi, rbx
    mov     eax, 0
    call    _printf
    retn
</code></pre>
<p>在<code>call _read</code>处正常动态调试，当我们正常输入的时候，输出值并不会变化，堆栈上的数据和返回地址也显示正常。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B3.png"></p>
<p>但当我们输入一串长度超过8的字符，比方说十几个字符全是a，我们看IDA：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B4.png"></p>
<p>此时，因为缓冲区溢出导致先前入栈的返回地址异常，我们的程序已经无法正常返回main而暴毙。而倘若我们利用python，使得input时输入了一串字符，令覆写的区域成功覆盖了整个返回地址，并将其引至函数<code>cat_flag()</code>，我们再试试：</p>
<pre><code>from pwn import *
r = process(&#39;input2&#39;)
cat_loc = 0x5642E4866188
payload = 16*b&#39;a&#39; + 0x4*b&#39;a&#39; + p64(cat_loc)
r.sendline(payload)
r.interactive()
</code></pre>
<p>熟悉pwn的同学应该明白，这就是pwn的基本原理——通过一些溢出漏洞来获取信息。但是这段代码并没有成功，这是因为linux的编译器在编译时自行加上了一些奇怪的东西。这就要提到接下来的部分了：</p>
<h4 id="如何保护你的代码"><a href="#如何保护你的代码" class="headerlink" title="如何保护你的代码"></a>如何保护你的代码</h4><p>书中列举了linux的gcc编译器使用的几种办法，来让你的代码免于遭受直接的缓冲区溢出攻击。</p>
<p><strong>1、栈随机化：</strong></p>
<p>顾名思义，每次运行时，栈的地址都会随机发生变化。实现方式是提前给栈分配一段0到n的随机大小的空间，程序不使用这段空间，但这段空间会使得整个栈的地址发生改变。这种防护技术在Linux系统中已经成为了常态化行为，称为“地址空间布局随机化”（ASLR）。</p>
<p><strong>2、栈破坏检测：</strong></p>
<p>编译器会在汇编代码中加入一种栈保护者的机制来检测缓冲区越界，即在缓冲区和栈保存的状态值之间存储一个特殊值，名为“金丝雀值”（canary），倘若因为缓冲区溢出导致这个值发生改变，那么程序产生异常中止。</p>
<p><strong>3、限制可执行代码区域：</strong></p>
<p>一种方法是限制哪些内存区域能存放可执行代码，例如AMD的64位处理器中含有的“NX”（不可执行）位，在不损失性能的前提下，由硬件完成是否可执行的判定（传统x86的硬件只能通过软件机制来阻止执行，这会使性能大打折扣）。</p>
<p>另一种办法则是动态地，即时地产生代码，将可执行代码限制在由编译器创建原始程序时产生的部分中。比方说Java程序的运行。</p>
<p><em>ps.在编写这一段的时候，我发现在gets外面再套一层指针有效地防止了我自己写出shell来：</em></p>
<pre><code>char *input()
&#123;
    static char buf[8];
    gets(buf);
    return buf;
&#125;
void cat_flag()
&#123;
    system(&quot;cat flag&quot;);
&#125;
int main()
&#123;
    printf(&quot;%s\n&quot;, input());
    return 0;
&#125;
</code></pre>
<p><em>所以说，多套几层指针保护函数或许也是一种保护代码的策略？</em></p>
<h4 id="但我们还是可以打进去"><a href="#但我们还是可以打进去" class="headerlink" title="但我们还是可以打进去"></a>但我们还是可以打进去</h4><p>众所周知，二进制方向有逆向（Reverse）和PWN两个分支，我们光靠逆向搞不定的事情，或许可以靠利用漏洞进行动态攻击来解决。接下来考虑对这种程序进行一个打。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B5.jpg"></p>
<p>额……能不能待会再……停停！我说停亻——</p>
<p>（不绝于耳的汤姆哀嚎）</p>
<p>咳咳……额……所以，我们在弄不清保护方法的情况下该怎样利用漏洞呢？从上回我们疯狂输入A也可以看出来，从数组到返回地址的偏移量为16，我们可以考虑利用printf格式化漏洞来输出栈的数据，具体可以参考<a target="_blank" rel="noopener" href="https://introspelliam.github.io/2017/08/04/printf%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%BC%8F%E6%B4%9E/">上善若水的文章</a>和<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41202237/article/details/107662273">hollk的文章</a>。</p>
<p>简单来说，就是printf在只设定了参数，没有设定输出内容的前提下，会自动在堆栈上向下查找数据，打印出接下来地址上的内容。当对应地址不存在时，这个程序就会boom。printf泄露最关键的参数之一就是%n,不输出字符，但是把已经成功输出的字符个数写入对应的整型指针参数所指的变量。</p>
<p>如果我们要尝试爆出某个地址上的数据，那不妨多重复几遍参数%p：</p>
<pre><code>from pwn import *

r = process(&#39;input2&#39;)

dist = 16
payload1 = b&#39;aaaa&#39; + 12 * b&#39;%p&#39;

r.sendline(payload1)
r_recv = str(r.read())
print(r_recv)
</code></pre>
<p>在ida动态调试时，软件产生了不同的栈地址，在这里泄露时也是一样（其实这一点在checksec里就能看出来，参考我老早以前的pwn题解）：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B6.png"></p>
<p>如上，我们可以看到输入的<code>aaaa</code>在相对printf指令偏移为7的地址，即格式化字符串的第七个参数。如果你想定向找出某个偏移上的数据，那不妨使用参数<code>aaaa%7$p</code>。</p>
<p>在后续调试过程中可以看出，改用短长度<code>&#39;%lx&#39;</code>语法段进行printf泄露的结果类似于“aaaa_[地址1]<em>50</em>[地址2]”的格式，并且，地址2无一例外都是以“0ed”后缀结尾。这里就要提到PIE的一大特性：</p>
<blockquote>
<p>程序每次运行，一些数据所在地址就会变更，但是这仅仅是libc的基地址发生变化，由于只是一个内存页的单位发生变化，那么地址的低三位就不会发生变化，即4KB(0x1000)不变。<br>——摘自<a target="_blank" rel="noopener" href="https://blog.fjt1.com/2019/11/18/pie%E4%BD%8E%E4%BD%8D%E8%A6%86%E7%9B%96/">Whitea的博客</a></p>
</blockquote>
<p>综上所述，我们可以构造printf，进而将新的返回地址溢出到返回值，从而完成调用。单纯的使用printf以及其它格式化输入输出的漏洞，对未开启NX保护的程序还算有效。但万一开了呢？又或者，程序并没有给出足够的系统指令来让你找到flag呢？</p>
<h4 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h4><p>这种办法简单来说就是先泄漏出从<code>libc.so</code>调用的某些函数在内存中的地址，即got表中库函数的地址，然后再利用泄漏出的函数地址根据偏移量计算出<code>system()</code>函数和<code>/bin/sh</code> 字符串（有时没有，需要手动构造）在内存中的地址，然后执行由它们组成的payload，完事。</p>
<p>从编译的角度来讲，这个过程讲究的就是一个“我打我自己”，即，用编译时封装给程序自身，或者库内含的函数，去探得或者直接调用实际运行时函数的内存地址。在程序本体缺斤少两时特别好用。</p>
<p>我们先通过<code>objdump -R [程序名]</code>指令指令，得出各库函数的<strong>got表（全局函数表）</strong>：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B7.png"></p>
<p>再去用<code>objdump -dj .plt input2</code>指令或者<code>objdump -d input2 | grep &quot;plt&quot;</code>得出函数的<strong>plt表（局部函数表）</strong>：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8B8.png"></p>
<p>这样，这个程序的静态信息就都显现出来了。当然，ida里面肯定是有的（笑）</p>
<p>先前通过ldd指令集得知编译用的libc库是<code>/lib/x86_64-linux-gnu/libc.so.6</code>，虽然不一定用得上，但是至少在缺少泄露数据所需的库函数的时候，调用libc库是绝对需要的。另外，我们也可以通过python的LibcSearcher库来解决这个问题。</p>
<p>详细的实例可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/linyt/article/details/43643499">海枫的文章</a>和东林网安协会<a target="_blank" rel="noopener" href="https://www.0error.net/2021/10/46d4a28d.html">do1phin师傅的文章</a>，本文由于主要内容还是计算机系统组成，不多赘述，等到深入pwn的时候再研究。</p>
<p><em>ps.我在自己研究这玩意的时候，可能因为编译环境等各种问题，自己没pwn出来自己的程序，看看各位是否能用同样的原码跑出一个能pwn的程序</em></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">学习</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%8B%EF%BC%89/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-深入理解计算机系统学习笔记-第四篇（中）" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%AD%EF%BC%89/">深入理解计算机系统学习笔记-第四篇（中）</a>
    </h1>
  

        
        <a href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%AD%EF%BC%89/" class="archive-article-date">
  	<time datetime="2023-09-09T07:14:10.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-09-09</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="上回书说到"><a href="#上回书说到" class="headerlink" title="上回书说到"></a>上回书说到</h3><p>我们刚刚才把程序的机器表示做了个初探，这回我们来讲讲如何理解一个汇编语言程序的其它语句。</p>
<p>由于这次基本上都是各种指令的介绍，基本也忙不着小娜了。</p>
<h3 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h3><p>正儿八经的x86-64架构下的汇编数学运算包括：</p>
<h4 id="孤儿指令"><a href="#孤儿指令" class="headerlink" title="孤儿指令"></a>孤儿指令</h4><p><strong>lea(q) src dest：</strong>加载有效地址，实际上就是mov指令的变体，用于从内存读数据到寄存器，但实际原理不同于mov的数据转移，而是“地址复制”，即将源数据的引用地址转移到目的上。就有点类似于你在写C时这样做：</p>
<pre><code>int *a, *b;
&amp;a = b;
</code></pre>
<p>实际上就等价于<code>leaq %rbx %rax</code>。但有点不同的是，leaq也可以负责简单算式的复制，比方说如果我们把上一条指令改成<code>leaq 3(%rbx,%rbx,3) %rax</code>，那么rax被赋予的实际数值就是&#x2F;(3b+3&#x2F;)。</p>
<h4 id="一元操作"><a href="#一元操作" class="headerlink" title="一元操作"></a>一元操作</h4><blockquote>
<p><strong>inc dest：</strong>对目标+1<br><strong>dec dest：</strong>对目标-1<br><strong>neg dest：</strong>对目标取负<br><strong>not dest：</strong>对目标取补码</p>
</blockquote>
<h4 id="二元操作"><a href="#二元操作" class="headerlink" title="二元操作"></a>二元操作</h4><blockquote>
<p><strong>add src dest：</strong>目的&#x3D;目的+源<br><strong>sub src dest：</strong>目的&#x3D;目的-源<br><strong>imul src dest：</strong>目的&#x3D;目的*源<br><strong>xor src dest：</strong>目的&#x3D;目的 异或 源<br><strong>or src dest：</strong>目的&#x3D;目的 或 源<br><strong>and src dest：</strong>目的&#x3D;目的 与 源</p>
</blockquote>
<h4 id="移位操作"><a href="#移位操作" class="headerlink" title="移位操作"></a>移位操作</h4><blockquote>
<p><strong>sal k dest：</strong>算术左移k位<br><strong>shl k dest：</strong>逻辑左移k位（左移都是低位补0所以效果一样）<br><strong>sar k dest：</strong>算术右移k位（空位补符号位）<br><strong>shr k dest：</strong>逻辑右移k位（空位补0）</p>
</blockquote>
<h4 id="特殊操作"><a href="#特殊操作" class="headerlink" title="特殊操作"></a>特殊操作</h4><blockquote>
<p><strong>imul(q) src (dest)：</strong>两个8字节数的有符号全乘法，对于积，rdx存放高64位，rax存放低64位<br><strong>mul(q) src (dest)：</strong>两个8字节数的无符号全乘法，同上<br><strong>cqto：</strong>转换为16字节数<br><strong>idiv(q) src：</strong>16字节数的有符号整除，rdx存放高64位，rax存放低64位，商转移至rax，余数转移至rdx<br><strong>div(q) src：</strong>无符号整除，同上</p>
</blockquote>
<hr>
<h3 id="逻辑控制"><a href="#逻辑控制" class="headerlink" title="逻辑控制"></a>逻辑控制</h3><p>到上面那一块为止，我们还停留在整串代码直线运行的情况。但是，如果你看过ida就会发现，绝大多数的函数的逻辑都是树形结构。构成这些树形分支的，就是一连串的逻辑控制。逻辑控制是啥呢？回去看看你的if、else啥的，那就是了。</p>
<p>在汇编中自然也有这些：</p>
<h4 id="条件码"><a href="#条件码" class="headerlink" title="条件码"></a>条件码</h4><p>其实本质上，机器级别的代码控制都是硬件控制。就比方说我们的减法，就是拿<strong>算术逻辑单元ALU</strong>，去读两个寄存器的值进行运算的。而这个逻辑单元不但会运算，还会用计算结果去设置条件码寄存器：</p>
<p>条件码寄存器由CPU维护，长度为单个位，描述最近的算术或逻辑操作的属性。在每次产生数据操作经过ALU时，这些寄存器的值会被重新设置。具体类别如下：</p>
<blockquote>
<p><strong>CF：</strong>进位标志，判断最近一个操作是否产生数据最高位进位，进位置1否则置0，常用于判断数据是否溢出<br><strong>ZF：</strong>零标志，判断最近一个操作的结果是否等于0，等于0则置1，否则置0<br><strong>SF：</strong>零标志，判断最近一个操作的结果是否小于0，小于0则置1，否则置0<br><strong>OF：</strong>溢出标志，判断最近一个操作是否使有符号数产生 <strong>正溢出 &#x2F; 负溢出</strong>，产生则置1，否则置0<br><strong>AF：</strong>辅助进位标志，判断最近一个字节操作是否发生低字节向高字节进位或借位，或者低四位向高四位进位或借位，发生置1，否则置0。<br><strong>PF：</strong>奇偶标志，记录最近一个操作的结果的二进制形式为1的位，若数量为偶数置1，否则置0<br><strong>DF：</strong>方向标志，决定串操作执行时有关寄存器发生调整的方向<br><strong>IF：</strong>中断标志，决定CPU是否相应CPU外部的可屏蔽中断发生的中断请求（但无法阻止不可屏蔽的外部请求和所有的内部请求，中断相关知识可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/Ann_xia6/article/details/125767999">Ann_xia66的博客</a>），置1时可响应，置0时不可响应。<br><strong>TF：</strong>追踪标志，置1时程序单步步过，置0时程序正常运转（反汇编软件会不会就是写入了修改TF的shell来实现单步步过）  </p>
</blockquote>
<p>因此，一些运算会导致条件码寄存器的既定变更。例如异或操作必定会令CF和ZF置0、加&#x2F;减法必定会导致CF和OF的变更，etc.</p>
<h4 id="逻辑判断"><a href="#逻辑判断" class="headerlink" title="逻辑判断"></a>逻辑判断</h4><p>需要用到条件码的不只是运算指令，还有比较指令cmp系列和test系列，以及set指令系。</p>
<h5 id="cmp系"><a href="#cmp系" class="headerlink" title="cmp系"></a>cmp系</h5><p>大致格式为<code>cmp dest src</code>，根据两个操作数的差来设置ZF和CF条件码，但是不设置非条件码寄存器。</p>
<p>目的操作数 &lt; 源操作数时，ZF置0，CF置1。<br>目的操作数 &gt; 源操作数时，ZF置0，CF置0。<br>目的操作数 &#x3D; 源操作数时，ZF置1，CF置0。  </p>
<h5 id="test系"><a href="#test系" class="headerlink" title="test系"></a>test系</h5><p>大致格式为<code>test dest src</code>，同理，根据两个操作数与的结果来设置条件码。</p>
<p>目的操作数&lt;源操作数时，ZF置0，CF置1。<br>目的操作数&lt;源操作数时，ZF置0，CF置1。<br>目的操作数&lt;源操作数时，ZF置0，CF置1。</p>
<h5 id="set系"><a href="#set系" class="headerlink" title="set系"></a>set系</h5><p>set指令通过条件码的不同组合来设置对象的最低位。具体操作如下：</p>
<blockquote>
<p><strong>sete&#x2F;setz dest：</strong>ZF若为1则将目标寄存器低位置1，否则置0，多用于判断相等或零条件<br><strong>setne&#x2F;setnz dest：</strong>与上述相反，判断不等&#x2F;非零条件</p>
<p><strong>sets dest：</strong>SF若为1则将目标寄存器低位置1，否则置0，多用于判断负数<br><strong>setns dest：</strong>与上述相反，判断非负</p>
<p><strong>setg&#x2F;setnle dest：</strong>条件为<del>(SF ^ OF) &amp; ~ZF，判断大于<br><strong>setge&#x2F;setnl dest：</strong>条件为</del>(SF ^ OF)，判断大于等于<br><strong>setl&#x2F;setnge dest：</strong>条件为SF ^ OF，判断小于<br><strong>setle&#x2F;setng dest：</strong>条件为(SF ^ OF) | ZF，判断小于等于</p>
<p><strong>seta&#x2F;setnbe dest：</strong>条件为<del>CF &amp; ~ZF，判断无符号大于<br><strong>setae&#x2F;setnb dest：</strong>条件为</del>CF，判断无符号大于等于<br><strong>setb&#x2F;setnae dest：</strong>条件为CF，判断无符号小于<br><strong>setbe&#x2F;setna dest：</strong>条件为CF | ZF，判断无符号小于等于</p>
</blockquote>
<p>所以一组完整的判断指令应该是cmp&#x2F;test指令和set指令、mov指令等的结合，以实现不同情况下的特殊判断。比方说我们要汇编实现一个比较函数，判断两个数是否相等：</p>
<pre><code>int comp(data_t a, data_t b)
</code></pre>
<p>我们需要使用如下代码：</p>
<pre><code>cmpq %rsi %rdi    //比较A和B
sete %al          //然后查看ZF是否为0，若不为0则相等，al置1
movzbl %al, %eax  //判定结果存入零拓展的a寄存器，高字节清零
</code></pre>
<h4 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h4><p>不过，光有逻辑指令可完不成实现复杂功能的逻辑判断，我们还需要跳转指令jmp系列，通过调用条件码来进行指令分支。</p>
<p>基本格式形似<code>jmp dest</code>，跳转到目标地址进行接下来的运作。如果需要调用寄存器值进行间接跳转，还需要在目标前加上“*”标记，这样就可以读取目标寄存器中的值作为地址进行跳转。除此之外，还有各种逻辑跳转，具体操作如下：</p>
<blockquote>
<p><strong>jmp dest：</strong>直接跳转  </p>
<p><strong>je&#x2F;jz dest：</strong>条件为ZF，相等时跳转<br><strong>jne&#x2F;jnz dest：</strong>条件为<del>ZF，不等时跳转<br><strong>js dest：</strong>条件为SF，为负时跳转<br><strong>jns dest：</strong>条件为</del>SF，非负时跳转</p>
<p><strong>jg&#x2F;jnle dest：</strong>条件为<del>(SF ^ OF) &amp; ~ZF，大于时跳转<br><strong>jge&#x2F;jnl dest：</strong>条件为</del>(SF ^ OF)，大于等于时跳转<br><strong>jl&#x2F;jnge dest：</strong>条件为SF ^ OF，小于时跳转<br><strong>jle&#x2F;jng dest：</strong>条件为(SF ^ OF) | ZF，小于等于时跳转</p>
<p><strong>ja&#x2F;jnbe dest：</strong>条件为<del>CF &amp; ~ZF，无符号大于时跳转<br><strong>jae&#x2F;jnb dest：</strong>条件为</del>CF，无符号大于等于时跳转<br><strong>jb&#x2F;jnae dest：</strong>条件为CF，无符号小于时跳转<br><strong>jbe&#x2F;jna dest：</strong>条件为CF | ZF，无符号小于等于时跳转</p>
</blockquote>
<p>所以说，我们要实现两个数是否相等的判定，也可以用汇编这么写</p>
<pre><code>    cmpq %rsi %rdi
    je L1.
    movzbl %al 1
    retn
L1.
    movzbl %al 0
    retn
</code></pre>
<p>不过看上去有点麻烦。如果感兴趣，可以自己先用C写一个简单条件判断，再IDA打开看一眼。</p>
<p>除此之外，如果学好了C，各位应该也知道，逻辑表达式也可以作为值被赋到变量上。比方说，判断两个数相等，我们能这么写：</p>
<pre><code>int comp(data_t a, data_t b)&#123;
    if(a==b)return 1;
    return 0;
&#125;
</code></pre>
<p>也可以这么写：</p>
<pre><code>int comp(data_t a, data_t b)&#123;
    int result = (a==b);
    if(result)return 1;
    return 0;
&#125;
</code></pre>
<p>（各位压行人轻点喷，这段代码只是方便理解）</p>
<p>同样地，除了逻辑跳转，汇编语言也自带逻辑赋值。具体操作如下：</p>
<blockquote>
<p><strong>cmove&#x2F;cmovz src dest：</strong>条件为ZF，相等时赋值<br><strong>cmovne&#x2F;cmovnz src dest：</strong>条件为<del>ZF，不等时赋值<br><strong>cmovs src dest：</strong>条件为SF，为负时赋值<br><strong>cmovns src dest：</strong>条件为</del>SF，非负时赋值</p>
<p><strong>cmovg&#x2F;cmovnle src dest：</strong>条件为<del>(SF ^ OF) &amp; ~ZF，大于时赋值<br><strong>cmovge&#x2F;cmovnl src dest：</strong>条件为</del>(SF ^ OF)，大于等于时赋值<br><strong>cmovl&#x2F;cmovnge src dest：</strong>条件为SF ^ OF，小于时赋值<br><strong>cmovle&#x2F;cmovng src dest：</strong>条件为(SF ^ OF) | ZF，小于等于时赋值</p>
<p><strong>cmova&#x2F;cmovnbe src dest：</strong>条件为<del>CF &amp; ~ZF，无符号大于时赋值<br><strong>cmovae&#x2F;cmovnb src dest：</strong>条件为</del>CF，无符号大于等于时赋值<br><strong>cmovb&#x2F;cmovnae src dest：</strong>条件为CF，无符号小于时赋值<br><strong>cmovbe&#x2F;cmovna src dest：</strong>条件为CF | ZF，无符号小于等于时赋值</p>
</blockquote>
<h4 id="逻辑控制的应用"><a href="#逻辑控制的应用" class="headerlink" title="逻辑控制的应用"></a>逻辑控制的应用</h4><p>不过，逻辑控制码这一堆玩意，能实现的东西不只是if else分支结构而已。比如说简单的while循环结构，你可以将一个寄存器设置为循环变量，再通过cmp一个立即数或者另外被赋值的寄存器来设置循环上限，jmp来进行程序的回环。比方说我们想实现一个朴素的2的N次幂，那么实现出来应该是类似如下的结构：</p>
<pre><code>    (input in %rax)
    mov $1 %rdi
    mov %rax %rsi
    ……
L2.
    imul $2 %rdi
    sub $1 %rsi
    cmp $1 %rsi
    jg .L2
    retn 
</code></pre>
<p>用阳间的高级语言翻译一下就是这样：</p>
<pre><code>int func(int round)&#123;
    int i = round, res = 1;
    while(i)&#123;
        res *= 2;
        i--;
    &#125;
    return res;
&#125;
</code></pre>
<p>这么一看，在某些地方，汇编语言确实比高级语言精简，但高级语言胜在视觉上的强逻辑性，以及长篇代码以至于整个项目的可读性，毕竟逆向手都明白，看汇编都够痛苦了，用汇编去堆屎山不是更加难于登天。</p>
<p>运用类似的方法，你可以构造出for、do-while、switch等结构，这里就不一一演示了，各位感兴趣可以自行编译一个程序试试。</p>
<hr>
<h3 id="非常好逻辑控制，但是函数呢？"><a href="#非常好逻辑控制，但是函数呢？" class="headerlink" title="非常好逻辑控制，但是函数呢？"></a>非常好逻辑控制，但是函数呢？</h3><p>可是函数间的跳转，相对于函数内部各种要素的转移就显得有些麻烦。我们首先得理解函数这一概念的底层逻辑：</p>
<h4 id="过程与栈调用"><a href="#过程与栈调用" class="headerlink" title="过程与栈调用"></a>过程与栈调用</h4><p>过程是对软件中被分割的不同功能块的一种抽象，它提供一种封装代码的方式，用一组指定参数和一个可选的返回值实现某种功能。简单来说，如果把代码比作一个农业合作社，过程就是将一个代码中的一个功能打包成一个工作小组，你可以安排给这个工作小组以它能够完成的特定任务，也就是<strong>参数传递（传参）</strong>，然后等待这个小组执行完任务，向你汇报结果或者自行消化，也就是<strong>返回值</strong>。</p>
<p>所以，你可以想到，C、python之类语言的函数是过程，abap的子例程是一种过程，甚至连java的类也可以近似看作过程。</p>
<p>在计算机中，正在执行的过程的数据是集中在栈里的。一个函数未被调用的时候，该函数及其调用链上下一级函数，也就是被它调用的函数，都处于挂起状态，当我们调用这个函数的时候，与函数相关的数据倘若光靠寄存器没办法存完，我们就需要调用栈空间，这部分空间被称为栈帧。</p>
<p>举个例子，当你需要依靠C语言程序加密长文本，并且这个长文本好巧不巧是个局部变量，你不可能指望十几个寄存器能放下一整篇《傲慢与偏见》，于是函数只能开帧。</p>
<p>具体而言，栈中存放的不只是你正在执行的函数的帧，还有被这个函数调用的函数的帧。帧中的内容包括各种直接数据和各种调用地址，尤其是函数的<strong>返回地址</strong>，这决定了如果这个函数是“被调用者”，那么在它结束流程后，“调用者”应该从何处继续它的任务。</p>
<p>由于函数操作的复杂性，一般的push指令肯定是完成不了相应任务了，我们只好使用转移控制指令：</p>
<h4 id="转移控制"><a href="#转移控制" class="headerlink" title="转移控制"></a>转移控制</h4><p>转移控制指令一般如下：</p>
<blockquote>
<p><strong>call dest：</strong>调用目标地址的函数<br><strong>ret(n)：</strong>从过程调用中返回</p>
</blockquote>
<p>指令call执行时，将目标函数第一个指令存入程序指令寄存器rip，并将返回地址压栈，函数开始执行。函数调用执行完毕之后，执行retn指令，返回地址出栈并被存入rip中，函数返回，继续执行先前位置之后的操作。</p>
<p>至于传参的过程，传入的前六个参数可以使用%rdi、%rdx、%rsi、%rcx、%r8、%r9寄存器（后缀视操作数大小而定），之后的数据就要依靠栈寄存器来界定其指针位置。寄存器之后的后续数据所占用的栈空间视其数据类型和系统操作数而定。比方说你开了一个int那地址只会每隔一个数据+4，但long就是+8，etc。</p>
<p>此外，如果一个局部变量使用地址运算符“&amp;”，那么栈上也必须强行为它开一个地址。</p>
<p>转移控制的典型案例在《深入理解计算机系统》原书有提及，本文不再赘述。</p>
<h4 id="寄存器中的局部存储空间"><a href="#寄存器中的局部存储空间" class="headerlink" title="寄存器中的局部存储空间"></a>寄存器中的局部存储空间</h4><p>不过，既然传参要用到寄存器，那么就不可避免的会有一个问题：寄存器是所有函数的公共资源，就像农业生产合作社里工具和劳动者的关系一样。只不过，合作社有使用工具的规章制度，寄存器的调用也有被刻入CPU的惯例。</p>
<p>这个惯例规定，rbx、rbp和r12<del>r15寄存器作为被调用者保存寄存器，当函数被调用时，这些寄存器的值在调用过程开始被保存在栈中，在调用过程结束时出栈，恢复到原本的寄存器中，函数调用前后保持不变；rdi、rsi、rdx、rcx、rax、r8</del>r11作为调用者保存寄存器，这些寄存器的值在调用开始前就被预先保存，在调用完成后恢复到寄存器中。</p>
<p>比方说，我们再回到2的n次幂那段代码上：</p>
<pre><code>    (input in %rax)
    mov $1 %rdi
    mov %rax %rsi
    ……
L2.
    imul $2 %rdi
    sub $1 %rsi
    cmp $1 %rsi
    jg .L2
    retn
</code></pre>
<p>如果我们要正儿八经地按照系统惯例实现，那么，这段代码大抵是这样的：</p>
<pre><code>    (input in %rax)
    push %rdi
    push %rsi
    mov $1 %rdi
    mov %rax %rsi
    call func_2mul
    mov %rdi %rbx
    pop %rsi
    pop %rdi
    ……
func_2mul:
L2.
    imul $2 %rdi
    sub $1 %rsi
    cmp $1 %rsi
    jg .L2
    retn
endp
</code></pre>
<p>如上，因为我们使用rdi和rsi这两个寄存器，所以一般而言，我们需要在调用函数前就将它们的数据入栈存储，在调用完毕后恢复。</p>
<p>其它的案例在原书中以及各路dalao的资料里有体现，这里按下不表，仅作抛砖引玉。</p>
<p>除此之外，函数也可以通过自己call自己实现递归调用，原理与函数内部的循环语句类似：</p>
<pre><code>rfact:
    push ……
    sub $1 %rsi
    cmp $1 %rsi
    jg .L3
    lea ……
    call rfact
.L3
    pop ……
    ret
</code></pre>
<hr>
<p>如上，我们浅浅学习了一下关于机器码实现运算和逻辑控制、函数调用等操作。可能量有点大，但是忍一下，大的还在后头呢——</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">学习</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%AD%EF%BC%89/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-深入理解计算机系统学习笔记-第四篇（上）" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%8A%EF%BC%89/">深入理解计算机系统学习笔记-第四篇（上）</a>
    </h1>
  

        
        <a href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%8A%EF%BC%89/" class="archive-article-date">
  	<time datetime="2023-09-09T07:12:36.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-09-09</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>好的，我们接着回来看《深入理解计算机系统》……这名字都已经刻在我的输(D)入(N)法(A)里了。</p>
<p>这一篇的内容很大一部分是对于逆向手再熟悉不过的汇编语言。由于原书中程序的机器级表示是一个长达一百余页的超耐久回，一回肯定讲不完，所以哪怕是分期也得讲的简练一点。</p>
<hr>
<h3 id="从编码开始"><a href="#从编码开始" class="headerlink" title="从编码开始"></a>从编码开始</h3><p>如果我们需要编译我们所写的代码，往往都是从这一句指令开始：</p>
<pre><code>gcc -o -Wall hello_world.c
</code></pre>
<p>当然，今天为了看的清楚一点，我们特地使用-Og选项，因为我们需要更贴近于C语言格式的汇编代码，如果开了o1甚至o2优化的话那八成会产生只有小娜看得懂的贵物。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8A1.jpg"></p>
<p>但是今天没你啥事，歇着吧。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8A2.jpg"></p>
<p>哦对了，现在她在打只狼，所以她很烦抢线程的语言理解环节。那咱们赶紧进入正片：</p>
<p>至于编译器运作的流程，我们之前应该都讲清楚了，这里不再赘述。不过，我们知道汇编程序的大体结构，但是……</p>
<h3 id="细节呢？"><a href="#细节呢？" class="headerlink" title="细节呢？"></a>细节呢？</h3><p>这就得结合一些源代码来讲了。比方说我们真的就写一个halloworld.c：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &quot;lib_text.h&quot;

void multstore(long x, long y, long *dest) &#123;
    long t = mult2(x, y);
    *dest = t;
&#125;
int main()
&#123;
    return 0;
&#125;
</code></pre>
<p>由于库函数没给mult2乘法，于是自己写了个lib_text.c的代码如下：</p>
<pre><code>#include &quot;lib_text.h&quot;

int mult2(int a,int b)&#123;
    return a*b;
&#125;
</code></pre>
<p>最后生成可执行文件halloworld用了如下指令：</p>
<pre><code>gcc -c -Og lib_text.c
gcc -c -Og halloworld.c
gcc -Og -o halloworld halloworld.o lib_text.o
</code></pre>
<p>我们在ida反汇编multstore函数的时候看到的是如下的代码：</p>
<pre><code>push rbx
mov rbx,rdx
call mult2
mov [rbx], rax
pop rbx
retn
</code></pre>
<p>这与我们直接使用-S选项调出halloworld.c的汇编编译结果是相似的，如果排除掉含前缀点的，引导汇编器和连接器的语句的话：</p>
<pre><code>    .file	&quot;halloworld.c&quot;
    .text
    .globl	multstore
    .type	multstore, @function
multstore:
.LFB11:
    .cfi_startproc
    pushq	%rbx
    .cfi_def_cfa_offset 16
    .cfi_offset 3, -16
    movq	%rdx, %rbx
    call	mult2@PLT
    movq	%rax, (%rbx)
    popq	%rbx
    .cfi_def_cfa_offset 8
    ret
    .cfi_endproc
</code></pre>
<p>非常简单。但为什么是rbx寄存器充当存储数据的角色，又为什么需要入栈出栈的操作？</p>
<h4 id="从寄存器开始"><a href="#从寄存器开始" class="headerlink" title="从寄存器开始"></a>从寄存器开始</h4><p>我们都知道又作用类似于变量，但数量和代号都固定的，名为“寄存器”的存在。</p>
<p>在intel x86-64的cpu架构里，寄存器包括通用寄存器rax（累加器，加法执行）、rbx（基址寄存器，数据存取）、rcx（计数寄存器，循环计数）、rdx（数据寄存器，读写I&#x2F;O端口时存放端口号）、rsi（字符串源）&#x2F;rdi（字符串目的地址）、rbp（栈底指针）&#x2F;rsp（栈顶指针）、r8~r15（64版本新增通用寄存器）。</p>
<p>在回到我们的函数的同时，需要提到两个概念，调用者保存寄存器（Caller-saved Register）和被调用者保存寄存器（Callee-saved Register）。至于“调用者”和“被调用者”的概念差别，举个简单的例子就是你的函数和你所调用的变量。</p>
<p>因此从定义上而言，用于存取的rbx就是一种典型的被调用者保存寄存器。我们也经常使用push(q)、mov(q)和pop(q)指令来让rbx寄存器中的数据与函数的堆栈交互，譬如如上的程序，我们就用这些指令，实现了从外源函数Mul2的地址到整型t（<code>push rbx；mov rbx,rdx</code>），再从t到dest指针（<code>mov [rbx], rax</code>）的整个赋值链条。至于这些指令具体的功用，则是接下来的内容：</p>
<h4 id="包括push和pop在内的数据传送指令"><a href="#包括push和pop在内的数据传送指令" class="headerlink" title="包括push和pop在内的数据传送指令"></a>包括push和pop在内的数据传送指令</h4><p>一个函数要实现功能，那必须令其构成一条完整的指令，这尤其是汇编语言逃不开的内容。比如说你做逆向要绕过反调试，你肯定是修改call或者jmp调用的地址，或者干脆整个nop了，而不是暴力删除地址。</p>
<p>一个完整的数据传送指令，包含**操作码(Operation Code)<strong>部分和</strong>操作数(Operands)**部分。操作码即为我们看到的指令前半段诸如pop、push的部分，负责告诉你的CPU你要干嘛，而操作数则是后续跟进的参数。目前来讲，你可以将两者简单理解为汇编层面的库函数和所需参数。</p>
<p><em>ps：不论对于操作码还是操作数，不同数据类型的数据或操作码有各自的汇编代码后缀，比方说b后缀代表字符型，q后缀代表四字型，具体可以翻阅原书3.3部分。</em></p>
<p><em>ps2：操作码的后缀只是无关紧要的大小指示符，并不会对你读代码有什么影响，尽管这年头没多少需要你正儿八经全程手撕汇编的场合就是了</em></p>
<p>操作数又分为：</p>
<h5 id="立即数-Immediate"><a href="#立即数-Immediate" class="headerlink" title="立即数(Immediate)"></a>立即数(Immediate)</h5><p>简单理解就是写在函数里的常量，但因为是汇编，大部分情况下仅满足C语言定义的数值。部分系统的立即数带有“$”前缀。</p>
<h5 id="寄存器-Register"><a href="#寄存器-Register" class="headerlink" title="寄存器(Register)"></a>寄存器(Register)</h5><p>不需多说，但需要注意，高位系统的汇编会向下兼容到以下所有位数系统的寄存器。</p>
<h5 id="内存引用-Memory-Reference"><a href="#内存引用-Memory-Reference" class="headerlink" title="内存引用(Memory Reference)"></a>内存引用(Memory Reference)</h5><p>一般表现为带括号的寄存器（及其和立即数的组合）。</p>
<p>如果你认真了解过内存空间，以及自己看过《深入理解》的原书和之前的篇目，你就会知道整个内存空间可以被抽象地视为一个可以存取的数组，不过存取需要确切的起始地址和偏移（数据长度）。</p>
<p>而我们使用内存引用，最常用的方法是使用一种语法表示为$Imm(r_b, r_i, s)$，实际值为$Imm+R[r_b]+R[r_i]*s$的表示方法。$Imm$表示立即数偏移；$r_b$表示基址寄存器；$r_i$表示变址寄存器。s为比例因子，且必须是8以内的2的次方，取决于你源代码中定义的数组类型，比方说char单位仅占单字节，比例因子是1，int由于单位占4字节，比例因子是4。</p>
<p>至于其它形式，都是延伸自这一基础形式的变体，建议看书。</p>
<p>那么接下来，就是各类传送指令的操作数：</p>
<h5 id="mov系"><a href="#mov系" class="headerlink" title="mov系"></a>mov系</h5><p>mov，简单明了，格式为<code>mov src dest</code>，src表示源操作数，dest表示目的操作数，数据从源操作数表示的地址迁移至目的操作数表示的地址。若使用寄存器作为操作数，则mov的后缀必须与寄存器大小保持一致。指令本身和源操作数的地址上的元素构成一堆调用者和被调用者，你也可以将这个关系粗暴地理解为mov指令下源和目的的关系。</p>
<p>但是，我们也知道，高版本系统架构存在寄存器向下兼容，而面对不同位数的mov指令向不同位数下的相同寄存器传输数据，寄存器会根据指令位数不同而变更不同位数，比方说对于已经被赋值0x12345678的64位rax寄存器，我们使用movb为其赋值-1，则只有最后一个字节变成FF，也就是0x123456FF，但如果是movw就是0x1234FFFF。</p>
<p>总结而言，同名寄存器的不同位表示，对应自低位起占用不同的内存空间。</p>
<p>以下是一些特殊情况：</p>
<p><strong>1、在你使用movl指令时</strong>需要注意，movl在64位架构下使用时会习惯性地将寄存器高位4字节清零。如果哪道pwn题就利用这个机制让你的shell报废，那你可能得想点别的招。</p>
<p><strong>2、传送绝对四字（八字节）长度数据</strong>，使用<code>movabsq</code>，且以寄存器作为源时必须以寄存器为目的</p>
<p><strong>3、movz系列指令</strong>会把目的中剩余高位字节填充为0，以实现从至多为字的低大小单位源向高大小单位目的的数据传递。通俗点来讲，你可以理解为如果你想让char变量做数据源，让int变量做数据目的地，那你就用movzbl，也就是从字节到字的movz。两个单位后缀决定了传输源与目的的数据大小。</p>
<p><strong>4、movs系列指令</strong>会对目的的剩余字节进行符号扩展，即正数填充0，复数填充1。基本用法与movz相同，但额外支持四字节到八字节的传输movslq，以及拓展eax到rax的专用指令cltq。</p>
<h5 id="栈数据系（push，pop）"><a href="#栈数据系（push，pop）" class="headerlink" title="栈数据系（push，pop）"></a>栈数据系（push，pop）</h5><p>对于逆向手而言，栈的概念肯定不陌生，单进单出。你在ida里多半能看到每个函数对应的栈，这些栈其实对应着一段内存空间，毕竟数组就是可以拿来实现栈的，而内存空间抽象上就是数组。栈的增长方向从高地址向低地址，故栈顶元素地址最低，栈底元素地址最高，这点你从ida的function stack里从-N到+0的区间看，肯定会有比较直观的感受。</p>
<p>在原理上，系统通过栈顶指针的修改，来实现栈内数据的增删。每次push，栈顶寄存器的值，也就是栈顶地址减去对应数据位数的值，然后才把数据存入新拓展的栈顶地址。分开这两个动作就是如下指令：</p>
<pre><code>subn $len %rsp
movn %rxp (%rsp)
</code></pre>
<p>而pop则是会读取数据，而后令栈顶地址加上对应数据位数的值。拆开来就是这样：</p>
<pre><code>addn $len %rsp
movn (%rsp) %rxp
</code></pre>
<p>在你的函数定义局部变量之时，压栈就已经开始了。程序会先将你定义的变量对应的源数据，通过<code>push src</code>的格式进行压栈，然后执行函数的时候再通过<code>pop dest</code>格式的pop指令将数据弹出至指定目的寄存器，再进行各项运算。关于具体案例，你可以自行百度或查看原书，抑或是看看<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sV411b7c1/?spm_id_from=333.788&vd_source=ad23e79160a6a987f8cbe101bc9133e3">九曲阑干的视频</a>。</p>
<hr>
<p>如上，我们对程序的机器级表示，也就是汇编做了一个初探。</p>
<p>别急着晕，这才哪跟哪呢。前面的区域，以后还得探索呢~</p>
<p>等下，为什么还是有坤声？等下，我为啥要说还是？</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E5%9B%9B%E7%AF%87%E4%B8%8A3.jpg"></p>
<p>麻了，姑奶奶你消停消停（闭门声）</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">学习</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/09/09/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88%E4%B8%8A%EF%BC%89/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-某逆向鸡饲料的WACON2023跟团游记" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/09/09/%E6%9F%90%E9%80%86%E5%90%91%E9%B8%A1%E9%A5%B2%E6%96%99%E7%9A%84WACON2023%E8%B7%9F%E5%9B%A2%E6%B8%B8%E8%AE%B0/">某逆向鸡饲料的WACON2023跟团游记</a>
    </h1>
  

        
        <a href="2023/09/09/%E6%9F%90%E9%80%86%E5%90%91%E9%B8%A1%E9%A5%B2%E6%96%99%E7%9A%84WACON2023%E8%B7%9F%E5%9B%A2%E6%B8%B8%E8%AE%B0/" class="archive-article-date">
  	<time datetime="2023-09-09T06:46:05.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-09-09</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>这把被nep的xdm带飞了</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_NepNep_ranking.png"></p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_NepNep_solved.png"></p>
<p>但是自己还是拿了一些分，感觉还可以</p>
<p>但是自己并不会其它方向，因此这次其实是本人的RE wp</p>
<hr>
<h4 id="Baby-Artist"><a href="#Baby-Artist" class="headerlink" title="Baby Artist"></a>Baby Artist</h4><p>一开始不知道这玩意是什么，但是看左上角像控制流图，扔进必应识图一搜，是Piet。</p>
<p>这个语言的<a target="_blank" rel="noopener" href="https://esolangs.org/wiki/Piet">介绍</a>以及相关<a target="_blank" rel="noopener" href="https://gabriellesc.github.io/piet/">编辑器</a>放这了。简单来讲，这玩意就是个简化汇编，但是做了亿些艺术化处理，每条指令的颜色决定了下一个色块的指令，push相关的值由上一个色块的大小决定。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_baby_artist_1.png"></p>
<p>本质上，一整个程序就是一堆算式和比对的集合，而由于Piet没有cmp，判断是通过下一个字符乘以((上一次计算的结果与上一个字符的差)取反)的值。由于基底还是栈，先进后出，所以把这玩意放进去跑，能跑出后半段，但是前半段会进入一段 意⭐义⭐不⭐明 的循环，所以得手操。</p>
<p>各位可以品鉴一下其中一小段：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_baby_artist_2.png"></p>
<pre><code>not
push 10
push 5
push 2
* (get 2 * 5 = 10)
* (get 10 * 10 = 100)
push 5
- (get 100 - 5 = 95)
- (get -95 which means this letter must be &quot;_&quot;)
not
*
# not(a[i]-(2*5*10-5))=1

push 2
push 5
push 11
* (get 55)
* (get 110)
-
not
*
# not(a[i]-2*5*11)=1
</code></pre>
<p>如上，我们可以硬推flag：</p>
<pre><code>WACON2023&#123;fUn_Dr4W1ng!__w4nN4_try?&#125;
</code></pre>
<p>ps：实际上外网有个叫做<a target="_blank" rel="noopener" href="https://github.com/boothby/repiet">repiet</a>的工具，可助各位一臂之力，望周知</p>
<h4 id="Adult-Artist"><a href="#Adult-Artist" class="headerlink" title="Adult Artist"></a>Adult Artist</h4><p>这玩意看上去比较恐怖，因为它的特征完美符合<a target="_blank" rel="noopener" href="https://github.com/xoreaxeaxeax/REpsych">REpsych</a>生成的控制流图。如下是我经过改色之后产生的图片：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_AdultArtist_1.png"></p>
<p>然而有一个更加令人痛心的事实：这个程序除了main就只有这个被弄成画的函数。更加让人男泵的是，这玩意因为太大，你f5不起作用（各种意义上，不论是它没法反汇编还是就算能反汇编你也看不懂）</p>
<p>不过，老逆向人的直觉会让你从汇编上面找线索。我们看它的开头有101个switch case：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_AdultArtist_2.png"></p>
<p>我们随便点一个试试，你会发现它的逻辑都是对着eax寄存器嗯干：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_AdultArtist_3.png"></p>
<p>最后汇总的时候，我们可以明显地看到eax实际上存着你输入的某位，而过程是将被对应位的case处理过的你的输入和预存储的东西进行一次cmp。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/wacon2023_AdultArtist_4.png"></p>
<p>那思路很明显了，第一次运行自动patch过cmp，然后读dword里的东西，接着第二次运行再一个一个case的读汇编指令，然后自动化逆过程，一位一位地从dword还原输入，然后从控制台输入过case，最后拿到flag。（虽然实际上从代码表现来看，它是四位四位处理的）</p>
<p>但是，赛场上我并没有写出代码来，所以这个过程还是交给外网dalao来整活（摘自<a target="_blank" rel="noopener" href="https://hackmd.io/@sahuang/rkHD37ZA3#RevTerrible-Flavor">sahuang的题解</a>）：</p>
<blockquote>
<p>patch部分</p>
</blockquote>
<pre><code>data = open(&quot;masterpiece&quot;, &quot;rb&quot;).read()

bad = bytes.fromhex(&quot;2ec4e27196849a0c800e08&quot;)
nops = bytes([0x90] * len(bad))

jmpbad = bytes.fromhex(&quot;e900000000&quot;)
# these jmps should be jumping 11 bytes ahead
jmpgood = bytes.fromhex(&quot;e90b000000&quot;)

data = data.replace(bad, nops).replace(jmpbad, jmpgood)

target = 0x08049206
target = target.to_bytes(4, &quot;little&quot;)

assert data.count(target) == 1

start = data.find(target)
xdata = data[:start]

for i in range(101):
    jmpptr = data[start + i * 4:start + (i + 1) * 4]
    jmpptr = int.from_bytes(jmpptr, &quot;little&quot;)
    jmpptr += 11 # skip nops

    jmpptr = jmpptr.to_bytes(4, &quot;little&quot;)
    xdata += jmpptr

xdata += data[start + 404:]

open(&quot;masterpiece_patched&quot;, &quot;wb&quot;).write(xdata)
</code></pre>
<blockquote>
<p>还原算法部分</p>
</blockquote>
<pre><code>from pwn import *
from capstone import *

sbox = [101, 242, 170, 79, 1, 137, 147, 58, 194, 8, 28, 195, 59, 63, 123, 111, 56, 254, 219, 122, 144, 127, 95, 81, 75, 61, 23, 104, 128, 155, 41, 196, 136, 121, 245, 202, 40, 15, 6, 42, 112, 68, 103, 47, 35, 139, 185, 116, 120, 11, 114, 106, 141, 55, 30, 253, 175, 74, 80, 86, 161, 32, 255, 235, 94, 163, 183, 34, 248, 221, 110, 109, 89, 198, 209, 54, 226, 25, 93, 169, 229, 20, 131, 83, 208, 156, 187, 135, 52, 88, 165, 38, 143, 164, 172, 186, 213, 118, 124, 115, 26, 87, 78, 159, 36, 181, 151, 10, 39, 92, 227, 191, 91, 19, 126, 67, 4, 50, 31, 0, 22, 2, 97, 162, 217, 173, 145, 193, 212, 239, 51, 133, 224, 49, 243, 71, 24, 236, 244, 72, 180, 69, 60, 134, 228, 158, 119, 18, 203, 108, 132, 190, 201, 167, 53, 168, 152, 238, 218, 250, 231, 160, 199, 189, 76, 140, 252, 174, 12, 249, 65, 57, 77, 105, 146, 197, 37, 82, 7, 66, 206, 44, 13, 215, 99, 176, 210, 43, 150, 148, 184, 166, 64, 142, 17, 188, 96, 154, 130, 223, 33, 216, 125, 90, 45, 113, 27, 70, 29, 232, 205, 233, 84, 237, 129, 207, 222, 138, 85, 220, 21, 102, 178, 192, 234, 62, 149, 16, 214, 107, 5, 177, 3, 200, 153, 157, 179, 230, 171, 251, 246, 225, 204, 241, 73, 9, 211, 247, 182, 14, 100, 240, 98, 117, 46, 48]
inv_sbox = [sbox.index(i) for i in range(256)]
finales = [1294921289, 3556600223, 1209339435, 1851550862, 3576661803, 935542824, 890675233, 1466443951, 2899239426, 2509770635, 3811890241, 4189575110, 3407890776, 151811947, 2021481915, 2224322179, 937543787, 2656386893, 2430690788, 937170305, 1595242648, 1313689251, 3449380580, 3981305360, 1805462865, 1000700706, 1394137676, 3037656969, 2213052412, 621078233, 44681021, 3125866984, 2270629699, 81231002, 732808204, 1962199736, 500787935, 3021495503, 343658160, 2011362800, 3051343062, 2649999813, 479102860, 1517017809, 2535887555, 2767036793, 864456536, 3221496586, 1236923337, 2535989912, 750098417, 2125817032, 3181958189, 1206391945, 911571295, 3648355814, 1356734492, 3557631056, 2749801664, 1533604227, 1218930141, 3796472889, 2869013044, 2909236950, 770707252, 1775872345, 1668747571, 164579730, 3194457712, 309450627, 725278243, 2120079896, 225892262, 2486260442, 2483139025, 3603672921, 4265882258, 3540118190, 2883355033, 1214344214, 708738895, 1637597950, 4066117530, 843823022, 1243164200, 1354787218, 1808234221, 2545499367, 2573345003, 423063696, 4155282283, 1510805520, 3005416590, 3521755546, 1409845455, 487735804, 3385604609, 1807103354, 2376904603, 2343410443]

# max bits &gt; 0 == width of the value in bits (e.g., int_16 -&gt; 16)
# Rotate left: 0b1001 --&gt; 0b0011
rol = lambda val, r_bits, max_bits: \
    (val &lt;&lt; r_bits%max_bits) &amp; (2**max_bits-1) | \
    ((val &amp; (2**max_bits-1)) &gt;&gt; (max_bits-(r_bits%max_bits)))
 
# Rotate right: 0b1001 --&gt; 0b1100
ror = lambda val, r_bits, max_bits: \
    ((val &amp; (2**max_bits-1)) &gt;&gt; r_bits%max_bits) | \
    (val &lt;&lt; (max_bits-(r_bits%max_bits)) &amp; (2**max_bits-1))

def xor(a, b):
    return (a ^ b) &amp; 0xffffffff

def nott(a):
    return (~a &amp; 0xffffffff)

def sub(a, b):
    return (a - b) &amp; 0xffffffff

def add(a, b):
    return (a + b) &amp; 0xffffffff

def bswap(a):
    a3 = (a &gt;&gt; 24) &amp; 0xff
    a2 = (a &gt;&gt; 16) &amp; 0xff
    a1 = (a &gt;&gt; 8) &amp; 0xff
    a0 = (a &gt;&gt; 0) &amp; 0xff
    return (a0 &lt;&lt; 24) | (a1 &lt;&lt; 16) | (a2 &lt;&lt; 8) | a3

# &#123;&#39;inc&#39;, &#39;jmp&#39;, &#39;xor&#39;, &#39;bswap&#39;, &#39;sub&#39;, &#39;dec&#39;, &#39;not&#39;, &#39;nop&#39;, &#39;rol&#39;, &#39;mov&#39;, &#39;add&#39;, &#39;ror&#39;&#125;

msg = b&quot;&quot;

f = open(&quot;./masterpiece_patched&quot;, &quot;rb&quot;).read()
blocks = []
start = 0x1062
for _ in range(101):
    jmptableptr = int.from_bytes(f[start:start+4], &quot;little&quot;)
    print(hex(jmptableptr))
    start += 4
    blocks.append(jmptableptr - 0x8048000)

for ind, s in enumerate(blocks[:-1]):
    CODE = f[s:blocks[ind+1]] # idk get block
    ddd = []

    md = Cs(CS_ARCH_X86, CS_MODE_32)
    for i in md.disasm(CODE, 0x1000):
        ddd.append((i.address, i.mnemonic, i.op_str))

    ddd = ddd[::-1]
    fff = finales[ind]
    al = 0
    ah = 0
    cl = 0
    i = 0

    while (i &lt; len(ddd)):
        opp = ddd[i][1]
        sss = ddd[i][2]

        if opp == &#39;nop&#39; or opp == &#39;jmp&#39;:
            i += 1
            continue
        
        if opp == &#39;bswap&#39;:
            fff = bswap(fff)
            
        elif opp == &#39;add&#39;:
            vvv = int(sss[sss.index(&#39;,&#39;) + 1:], 16)
            fff = sub(fff, vvv)
            
        elif opp == &#39;sub&#39;:
            vvv = int(sss[sss.index(&#39;,&#39;) + 1:], 16)
            fff = add(fff, vvv)
            
        elif opp == &#39;ror&#39;:
            vvv = int(sss[sss.index(&#39;,&#39;) + 1:], 16)
            fff = rol(fff, vvv, 32)
            
        elif opp == &#39;rol&#39;:
            vvv = int(sss[sss.index(&#39;,&#39;) + 1:], 16)
            fff = ror(fff, vvv, 32)
            
        elif opp == &#39;xor&#39;:
            vvv = int(sss[sss.index(&#39;,&#39;) + 1:], 16)
            fff = xor(fff, vvv)
            
        elif opp == &#39;not&#39;:
            fff = nott(fff)
            
        elif opp == &#39;inc&#39;:
            fff = fff - 1
            
        elif opp == &#39;dec&#39;:
            fff = fff + 1
            
        elif opp == &#39;mov&#39;:
            if sss.startswith(&#39;cl, al&#39;):
                fff = (fff &gt;&gt; 8 &lt;&lt; 8) | cl
            elif sss.startswith(&#39;cl, ah&#39;):
                fff = (fff ^ (ah &lt;&lt; 8)) | (cl &lt;&lt; 8)
            elif sss.startswith(&#39;al, byte&#39;):
                al = fff &amp; 0xff
                cl = inv_sbox[al]
            elif sss.startswith(&#39;ah, byte&#39;):
                ah = (fff &gt;&gt; 8) &amp; 0xff
                cl = inv_sbox[ah]
            else:
                print(ddd[i])
                break
        # print(hex(ddd[i][0]), ddd[i], hex(fff))
        i += 1

    msg += int.to_bytes(fff, 4, &quot;little&quot;)
    print(msg)
</code></pre>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">CTF</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/09/09/%E6%9F%90%E9%80%86%E5%90%91%E9%B8%A1%E9%A5%B2%E6%96%99%E7%9A%84WACON2023%E8%B7%9F%E5%9B%A2%E6%B8%B8%E8%AE%B0/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-NSILAB二进制之耻的CISCN初赛复现" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/06/16/NSILAB%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B9%8B%E8%80%BB%E7%9A%84CISCN%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/">NSILAB二进制之耻的CISCN初赛复现</a>
    </h1>
  

        
        <a href="2023/06/16/NSILAB%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B9%8B%E8%80%BB%E7%9A%84CISCN%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/" class="archive-article-date">
  	<time datetime="2023-06-16T08:07:33.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-06-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="babyRE"><a href="#babyRE" class="headerlink" title="babyRE"></a>babyRE</h3><p>美化程序，查看文件，发现开头有：<code>&lt;project name=&quot;re4baby22&quot; app=&quot;Snap! 8.2, https://snap.berkeley.edu&quot; version=&quot;2&quot;&gt;</code><br>为Snap！程序，使用相应工具打开：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/babyre-1.png"></p>
<p>主要逻辑：整个输入序列后一位异或前一位，与答案比对，复现算法即可。</p>
<pre><code>secret = [102, 10, 13, 6, 28, 74, 3, 1, 3, 7, 85, 0, 4, 75, 20, 92, 92, 8, 28, 25, 81, 83, 7, 28, 76, 88, 9, 0, 29, 73,
          0, 86, 4, 87, 87, 82, 84, 85, 4, 85, 87, 30]
for i in range(1,len(secret)):
    secret[i] ^= secret[i-1]
for i in range(len(secret)):
    print(chr(secret[i]), end=&#39;&#39;)
</code></pre>
<h3 id="ezbyte"><a href="#ezbyte" class="headerlink" title="ezbyte"></a>ezbyte</h3><p>从start跟到sub_404C21，发现flag头尾校验，但代码最后跳转的判断部分sub_404BF5有一种脑干缺失的美，除了最后能隐约察觉它是想比对整个函数的返回值是否为0之外一无是处。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/ciscn2023_starting_ezbyte1.png"></p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/ciscn2023_starting_ezbyte2.png"></p>
<p>然而在看了题解之后，我才发现脑干缺失的是我自己——</p>
<h4 id="通过DWARF-Expression藏代码"><a href="#通过DWARF-Expression藏代码" class="headerlink" title="通过DWARF Expression藏代码"></a>通过DWARF Expression藏代码</h4><p>英文文档太难啃了，而且基本都是把DWARF Expression从机理到实现给你讲了个遍，用来塞题解显然不太现实，到时候再说。不过，看看<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-271891.htm#msg_header_h2_3">看雪上的文章</a>，以及<a target="_blank" rel="noopener" href="https://richar.top/nothingchu-ti-si-lu-ji-wp/">这道题的原型的题解</a>，应该还是比较轻松愉快的。</p>
<p>简单来说，跟我们之前在《深入理解》里看到的一样，许多异常处理之后需要进行状态还原，以保证程序运行，在C++里面是这样的——</p>
<blockquote>
<p>在类Unix系统中，由g++&#x2F;clang++编译出的程序，是使用DWARF调试信息完成这个恢复过程的。早期的DWARF标准只支持一些简单的原语以恢复运行状态，在DWARF 3标准中引入了一个DWARF Expression，可以将它理解为一个基于栈的虚拟机，由标准C++库解释执行它，它包含一系列的字节码，提供了读取程序运行内存的Handle，但不支持写入程序运行内存。</p>
<p>DWARF Expression支持的操作可以分为编码（入栈立即数），寄存器寻址（入栈 REG + OFFSET），栈操作（SWAP，POP等操作），算术运算，流程转移。我简单介绍一些常用的操作。</p>
</blockquote>
<p>所以，DWARF Expression实际上可以看作一个包含在调试信息内的简单虚拟机代码，可以复现一定范围内功能的源代码并执行，在编译过程之后这些信息在代码上便不可见，所以也很好地保护了代码。而我们要做的，就是将这些内容给提出来，再塞回去。</p>
<p>万幸，此前的出题人也准备好了应对手段。如下是将程序转换为正常C的rust代码：</p>
<pre><code>use std::&#123;collections::HashMap, fs, fmt::Display, io::Write&#125;;
use std::process::Command;
 
use gimli::UnwindSection;
use object::&#123;Object, ObjectSection&#125;;
 
fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; &#123;
    let mut arg = std::env::args();
    if arg.len() != 2 &#123;
        panic!(&quot;Argument Error!&quot;)
    &#125;
    let bin_data = fs::read(arg.nth(1).unwrap())?;
    let obj_file = object::File::parse(&amp;*bin_data)?;
    let data = obj_file.section_by_name(&quot;.eh_frame&quot;).unwrap();
    let eh_frame = gimli::read::EhFrame::new(data.data()?, gimli::LittleEndian);
    let bases = gimli::BaseAddresses::default().set_eh_frame(data.address());
    let mut entries = eh_frame.entries(&amp;bases);
 
    let mut file = fs::OpenOptions::new().append(false).truncate(true).write(true).create(true).open(&quot;./output.c&quot;)?;
    writeln!(file, &quot;#include &lt;stdint.h&gt;&quot;)?;
 
    let mut cies = HashMap::new();
    while let Some(entry) = entries.next()? &#123;
        if let gimli::CieOrFde::Fde(partial) = entry &#123;
            let fde = partial.parse(|_, bases, o| &#123;
                cies.entry(o)
                    .or_insert_with(|| eh_frame.cie_from_offset(bases, o))
                    .clone()
            &#125;)?;
            // 通过长度过滤出我们想要的
            if fde.entry_len() &lt; 100 &#123;
                continue;
            &#125;
            let mut instructions = fde.instructions(&amp;eh_frame, &amp;bases);
            use gimli::CallFrameInstruction::*;
            loop &#123;
                match instructions.next() &#123;
                    Err(e) =&gt; &#123;
                        println!(&quot;Failed to decode CFI instruction: &#123;&#125;&quot;, e);
                        break;
                    &#125;
                    Ok(Some(ValExpression &#123;
                                register,
                                expression,
                            &#125;)) =&gt; &#123;
                        println!(
                            &quot;DW_CFA_val_expression (&#123;&#125;, ...)&quot;,
                            gimli::X86_64::register_name(register).unwrap_or(&quot;&#123;unknown&#125;&quot;)
                        );
                        display_val_expression(register, expression, &amp;mut file)?;
                    &#125;
                    Ok(None) =&gt; &#123;
                        break;
                    &#125;
                    _ =&gt; &#123;&#125;
                &#125;
            &#125;
        &#125;
    &#125;
    file.flush()?;
 
    Command::new(&quot;gcc&quot;)
        .arg(&quot;-O3&quot;)
        .arg(&quot;./output.c&quot;)
        .arg(&quot;-c&quot;)
        .spawn()?;
 
    Ok(())
&#125;
 
#[derive(Clone, Copy)]
struct Val &#123;
    id: u64,
&#125;
 
impl Val &#123;
    fn new(id: u64) -&gt; Self &#123;
        Val &#123; id &#125;
    &#125;
&#125;
 
struct ValGenerator &#123;
    id: u64,
&#125;
 
impl ValGenerator &#123;
    fn new() -&gt; Self &#123;
        Self &#123; id: 0 &#125;
    &#125;
    fn next(&amp;mut self) -&gt; Val &#123;
        self.id += 1;
        Val::new(self.id - 1)
    &#125;
&#125;
 
impl Display for Val &#123;
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;&#39;_&gt;) -&gt; std::fmt::Result &#123;
        write!(f, &quot;v&#123;&#125;&quot;, self.id)
    &#125;
&#125;
 
fn display_val_expression&lt;R&gt;(target_reg: gimli::Register, exp: gimli::Expression&lt;R&gt;, w: &amp;mut dyn Write) -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt;
    where
        R: gimli::Reader,
&#123;
    let mut val_generator = ValGenerator::new();
    let mut ops = exp.operations(gimli::Encoding &#123; address_size: 8, format: gimli::Format::Dwarf64, version: 5 &#125;);
    let mut stack: Vec&lt;Val&gt; = Vec::new();
    writeln!(w, &quot;uint64_t cal_&#123;&#125;(uint64_t r12, uint64_t r13, uint64_t r14, uint64_t r15)&#123;&#123;", gimli::X86_64::register_name(target_reg).unwrap())?;
	    writeln!(w, "    uint64_t rax=0,rbx=0;")?;
	    loop &#123;
	        if let Ok(Some(op)) = ops.next() &#123;
	            match op &#123;
	                gimli::Operation::Drop => &#123;
	                    stack.pop();
	                &#125;
	                gimli::Operation::Pick &#123; index &#125; => &#123;
	                    let val1 = stack.get(stack.len() - 1 - index as usize).unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;;", new_val, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Swap => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    stack.push(val1);
	                    stack.push(val2);
	                &#125;
	                gimli::Operation::Rot => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let val3 = stack.pop().unwrap();
	                    stack.push(val1);
	                    stack.push(val3);
	                    stack.push(val2);
	                &#125;
	                gimli::Operation::And => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;&&#123;&#125;;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Minus => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;-&#123;&#125;;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Neg => &#123;
	                    let val = stack.get(stack.len() - 1).unwrap();
	                    writeln!(w, "    &#123;&#125;=-&#123;&#125;;", val, val)?;
	                &#125;
	                gimli::Operation::Not => &#123;
	                    let val = stack.get(stack.len() - 1).unwrap();
	                    writeln!(w, "    &#123;&#125;=~&#123;&#125;;", val, val)?;
	                &#125;
	                gimli::Operation::Or => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;|&#123;&#125;;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Plus => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;+&#123;&#125;;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::PlusConstant &#123; value &#125; => &#123;
	                    let val = stack.get(stack.len() - 1).unwrap();
	                    writeln!(w, "    &#123;&#125;+=&#123;&#125;ull;", val, value)?;
	                &#125;
	                gimli::Operation::Shl => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;<<&#123;&#125;;", new_val, val2, val1)?; stack.push(new_val); &#125; gimli::operation::shr> &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;>>&#123;&#125;;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Shra => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=(uint64_t)((int64_t)&#123;&#125;>>(int64_t)&#123;&#125;);", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Xor => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;^&#123;&#125;;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Eq => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;= &#123;&#125;==&#123;&#125;?1:0;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Ge => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;>=&#123;&#125;?1:0;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Gt => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;>&#123;&#125;?1:0;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Le => &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;<=&#123;&#125;?1:0;", new_val, val2, val1)?; stack.push(new_val); &#125; gimli::operation::lt> &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;<&#123;&#125;?1:0;", new_val, val2, val1)?; stack.push(new_val); &#125; gimli::operation::ne> &#123;
	                    let val1 = stack.pop().unwrap();
	                    let val2 = stack.pop().unwrap();
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;!=&#123;&#125;?1:0;", new_val, val2, val1)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::UnsignedConstant &#123; value &#125; => &#123;
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;ull;", new_val, value)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::SignedConstant &#123; value &#125; => &#123;
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=(uint64_t)&#123;&#125;ll;", new_val, value)?;
	                    stack.push(new_val);
	                &#125;
	                gimli::Operation::Register &#123; register &#125; => &#123;
	                    let new_val = val_generator.next();
	                    writeln!(w, "    uint64_t &#123;&#125;=&#123;&#125;;", new_val, gimli::X86_64::register_name(register).unwrap_or("&#123;error&#125;"))?;
	                    stack.push(new_val);
	                &#125;
	                _ => todo!("&#123;:?&#125;", op)
	            &#125;
	        &#125; else &#123;
	            break;
	        &#125;
	    &#125;
	    assert_eq!(stack.len(), 1);
	    writeln!(w, "    return &#123;&#125;;", stack.pop().unwrap())?;
	    writeln!(w, "&#125;&#125;\n&quot;)?;
    Ok(())
&#125;
</&#123;&#125;?1:0;",></=&#123;&#125;?1:0;",></&#123;&#125;;",></code></pre>
<p>配置rust的过程有点枯燥，但是<a target="_blank" rel="noopener" href="https://www.runoob.com/rust/rust-setup.html">菜鸟教程</a>解千愁。记得在Cargo.toml里加上你调用的库的配置（如下是我用的版本）：</p>
<pre><code>[dependencies]
gimli = &quot;0.26.1&quot;
object = &quot;0.29.0&quot;
rand = &quot;0.7.3&quot;
</code></pre>
<p>然后把你的被DWARF Expression的代码放到<code>项目目录\target\debug</code>里跑就完事了，但是有点奇怪：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/ciscn2023_starting_ezbyte3.png"></p>
<p>报错显示缺少注册表偏移，按着前面照猫画虎摸一个出来：</p>
<pre><code>gimli::Operation::RegisterOffset&#123; register, offset, ..&#125; =&gt;&#123;
                let new_val = val_generator.next();
                writeln!(w, &quot;    uint64_t &#123;&#125;=(&#123;&#125;+&#123;&#125;ull);&quot;, new_val, gimli::X86_64::register_name(register).unwrap_or(&quot;&#123;error&#125;&quot;),offset)?;
                stack.push(new_val);
            &#125;
</code></pre>
<p>也可以翻看<a target="_blank" rel="noopener" href="https://www.yulate.com/426.html">yulate佬的题解</a>抄一个，这里就不细说了。然后就是跑出来一个中间的.o文件和最后的c文件。由于反汇编自带代码简化，我们直接IDA看.o（代码因人而异）：</p>
<pre><code>__int64 __fastcall cal_r12(__int64 a1, __int64 a2, __int64 a3, __int64 a4)
&#123;
  return ((a3 + 1512312) ^ 0x2D393663614447B1i64)
       + ((a1 + 1892739) ^ 0x35626665394D17E8i64)
       + ((a2 + 8971237) ^ 0x65342D6530C04912i64)
       + ((a4 + 9123704) ^ 0x6336396431BE9AD9i64);
&#125;
</code></pre>
<p>一个数异或自己&#x3D;0，所以这就是个简单的判断，再加上它非常像某些十六进制字符数据，于是我们放进python逆推：</p>
<pre><code>a = [0, 0, 0, 0]
a[0] = 0x35626665394D17E8 - 1892739
a[1] = 0x65342D6530C04912 - 8971237
a[2] = 0x2D393663614447B1 - 1512312
a[3] = 0x6336396431BE9AD9 - 9123704

print(&quot;flag&#123;&quot;, end=&#39;&#39;)

for i in range(4):
    while a[i] &gt; 0:
        c = chr(int(a[i] % 0x100))
        print(c, end=&#39;&#39;)
        a[i] //= 256

print(&quot;3861&#125;&quot;)
</code></pre>
<blockquote>
<p>flag{e609efb5-e70e-4e94-ac69-ac31d96c3861}</p>
</blockquote>
<p>解多纯粹因为有脚本，我没解出来纯粹因为知识盲区，蔡就多练.jpg</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">CTF</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/06/16/NSILAB%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B9%8B%E8%80%BB%E7%9A%84CISCN%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-深入理解计算机系统学习笔记-第五篇（中）" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2023/06/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E4%BA%94%E7%AF%87%EF%BC%88%E4%B8%AD%EF%BC%89/">深入理解计算机系统学习笔记-第五篇（中）</a>
    </h1>
  

        
        <a href="2023/06/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E4%BA%94%E7%AF%87%EF%BC%88%E4%B8%AD%EF%BC%89/" class="archive-article-date">
  	<time datetime="2023-06-11T07:45:19.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-06-11</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>经历了ISCC和二十余篇报告的终极折磨，我终于……还是没解放</p>
<p>课程设计、期末考试、武术表演、CISCN……甚至还是AWD</p>
<p>我™真想给那屎忽的来一发超解口牙！我要把那可恶排班，可恶出题人，锁在地上吃我登龙口牙！！！杀！杀！杀！！！</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%AD-1.png"></p>
<p>害，算了，让我们收拾收拾心情，看看接下来的内容：</p>
<h3 id="进程控制"><a href="#进程控制" class="headerlink" title="进程控制"></a>进程控制</h3><p>这把的CISCN初赛，有一道pwn用上了一个恶心玩意，那就是<strong>fork</strong>。简单来讲，这玩意用来克隆一个与父进程在代码和堆栈等层面完全一致，也就是上回提到的0-3G的用户层部分完全一致，甚至连哪个变量的值是什么都一样，但在pid（每个进程的运行时唯一编号）、内核映射等方面不大一样的子进程（具体可以看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/53527981">享受生活 的文章</a>）。那道题目中，程序在while时通过fork创建子进程回传，再配合PIE地址随机化把没有做过多少pwn的我整的晕头转向。</p>
<p>当然，fork可不单单是出题人用来恶心人的道具，在错误处理、进程控制等方面，fork都有重要应用。实际上，你的linux shell也在用fork。当你打算打开一个程序，shell通过fork创建一个新的子进程。而这些就是我们接下来要讲的内容：</p>
<h4 id="fork的作用机理"><a href="#fork的作用机理" class="headerlink" title="fork的作用机理"></a>fork的作用机理</h4><p>以程序员角度，一个进程有三种状态，运行（Running，即在自己的逻辑控制流上，正在或等待执行的状态）、暂停（Stopped，进程被挂起，暂时不会被调度或执行）和终止（Terminated，进程不再被执行）。其中，暂停在进程收到 SIGSTOP &#x2F; SIGSTEP &#x2F; SIGTTIN &#x2F; SIGTTOU 信号时发生，而终止则在收到对应信号、主程序返回或者调用exit函数时发生。</p>
<p>fork的定义如下：</p>
<pre><code>#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

pid_t fork(void);
</code></pre>
<p>返回值在linux中定义为int，当子进程成功创建，fork在子进程中返回0，在父进程中返回子进程的PID。若子进程创建不成功返回-1。故正常运转的fork调用一次时会返回两次，一次子进程，一次父进程。比如如下代码：</p>
<pre><code>pid = fork();

if (pid == 0)&#123;
    printf(&quot;child detected\n&quot;);
    exit();
&#125;
printf(&quot;pid: %d\n&quot;, pid);
exit();
</code></pre>
<p>在子进程中，fork的返回值为0，故会输出<code>child detected</code>；在父进程中，fork的返回值为子进程的pid，故会输出<code>pid: 2</code>之类的东西。两个进程独立并发运行，且先后顺序不定，取决于你的操作系统。</p>
<p>如上，子进程相对于父进程，除了用户层分配的三个G是相同的之外，地址空间在构成上也是完全相同的，但两个空间相互独立。并且，它们调用的文件都是相同的。</p>
<p>以及，多次调用fork而不清理进程的话，会使得进程指数级增长，2fork出4进程，3fork出8进程，etc。为了你的电脑，请不要偷懒一次性多开fork，而没写回收的函数，要不然……</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%AD-2.png"></p>
<h4 id="为什么，以及如何回收进程呢"><a href="#为什么，以及如何回收进程呢" class="headerlink" title="为什么，以及如何回收进程呢"></a>为什么，以及如何回收进程呢</h4><blockquote>
<p>在Linux中正常情况下，子进程是通过父进程创建的，子进程再创建新的进程。子进程的结束和父进程的运行是一个异步过程，也就是说，父进程永远无法预知到子进程会在什么时候结束。当一个进程完成工作终止后，它的父进程需要调用<code>wait()</code>或<code>waitpid()</code>系统调用来获取子进程的终止状态。</p>
<p>——摘自<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/943f6cfff191">JunChow520的文章</a></p>
</blockquote>
<p>子进程的结束时间相对于父进程是不定的，正常来讲，子进程在父进程结束之前结束，并获得子进程状态，而倘若父进程先于子进程结束，那么这个子进程就成为了没父亲的<strong>孤儿进程</strong>，系统会安排init进程称为它的<strong>养父进程</strong>，其pid为1，是所有进程的祖先，亦是所有孤儿进程的“托儿所”。由于计算机系统并不像某些dfzf一样拖泥带水，这些孤儿进程一般都会得到妥善回收，所以这种情况是不需要我们处理的。</p>
<p>但<strong>僵死进程</strong>就不那么好办了。通常来讲，我们在父进程中会使用wait或者waitpid来回收，或者在父进程因为某些问题挂掉的时候让init领养，可一旦你在父进程中忘记回收，而你的子进程恰好在父进程运行的逻辑控制流中终止了，那它就成为了停止，但依旧在内核空间存在的僵死进程，即子进程残留资源PCB存放于内核中。</p>
<p>这些残留资源会一直存在于内核，并且占用相应的内存号，要是没有其它进程用wait或者waitpid发现它们，可能它们就一直呆在那里，直到你内存爆炸或者系统再也无法生成新的进程号，然后你的电脑就在寄掉的边缘徘徊。你也不能kill它们，因为它们已经是终止的进程了，就整一个处于死了也没死的状态，故又名<strong>僵尸进程</strong>，让计算机避之不及。</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%AD-3.png"></p>
<p>但好就好在，我们还有wait和waitpid可以利用。</p>
<p>wait函数可以阻塞当前进程，等待子进程退出，之后进行子进程的回收并获取子进程终止状态及原因。子进程的终止状态由<code>wait.h</code>库的几个宏定义：</p>
<blockquote>
<p>WIFEXITED(status) ：全称wait if exited，表示判断是否是正常退出的，若非0则表示进程正常退出<br>WEXITSTATUS(status) ：全称wait exit status，表示退出状态，当子进程正常退出，即WIFEXITED(status)为真则获取进程退出的状态，即exit的参数。<br>WIFSIGNALED(status) ：全称wait if signaled，若非0则表示进程异常终止<br>WTERMSIG(status)：全称wait term signal，若WIFSIGNALED为真则获得使进程终止的那个信号的编号。<br>WIFSTOPPED(status)：全称wait if stopped进程处于暂停状态，若非0则表示进程处于暂停状态<br>WSTOPSIG(status)：为真则使用宏WSTOPSIG(status)以获取使进程暂停的那个信号的编号。<br>WIFCONTINUED(status)：为真则表示进程暂停后已经继续运行  </p>
</blockquote>
<p>waitpid则更加灵活且具有指向性，可以指定pid进程清理且不带有进程阻塞。若pid小于-1表示回收指定进程组中的任意子进程；若pid等于0表示回收和当前调用waitpid一个组的所有子进程；若pid等于-1表示回收任意子进程，作用相当于wait函数；若pid大于0表示回收指定进程ID的子进程。</p>
<p>Linux中系统调用的错误都存储于 errno中，errno由操作系统维护，存储就近发生的错误，即下一次的错误码会覆盖掉上一次的错误。当调用进程没有子进程，则waitpid返回-1，并且设置errno为ECHILD。若waitpid被一个信号中断，则返回-1，并设置errno为EINTR。详细的errno状态列表可以参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Jimmy1988/p/7485133.html">Jimmy_Nie的文章</a>，这里不再赘述。</p>
<h4 id="加载并运行程序"><a href="#加载并运行程序" class="headerlink" title="加载并运行程序"></a>加载并运行程序</h4><p>fork可以克隆一个进程，但我们怎么在进程运行的过程中在打开一个新的程序呢？这就要用到<strong>execve</strong>了。execve函数在当前进程的上下文中加载并运行一个新程序，但是莫得返回值。execve的定义如下：</p>
<pre><code>#include &lt;unistd.h&gt;

int execve(const char *filename, const char *argv[], const char *envp[]);
</code></pre>
<p><strong>filename</strong>就是你要运行的程序名，<strong>argv</strong>表示执行这个程序需要的参数列表，<strong>envp</strong>表示环境变量列表。</p>
<p>关于argv，最直观的，你使用linux或者windows的shell执行某些程序或指令的时候，你在后面加上的一系列诸如<code>-o xxx</code>或者<code>--update</code>之类的东西就是这个程序运行需要的参数。<code>argv[0]</code>按照惯例是你的可执行文件或程序的名字，比方说我们需要在kali上修复并更新系统上的软件，那么我们一般会用（假设你已经是root权限了）：</p>
<pre><code>apt-get update --fix-missing
</code></pre>
<p>此时，argv内容如下，argc表参数个数（严格意义来讲是argv中非空指针的数量），argv以NULL结尾：</p>
<pre><code>argv[0] = &quot;apt-get&quot;
argv[1] = &quot;update&quot;
argv[argc-1] = &quot;--fix-missing&quot;
argv[argc] = NULL
</code></pre>
<p>envp和argv一样都是尾部为NULL的指针数组，但从0开始包含当前的环境变量信息，如文件路径pwd，用户名，系统版本等。环境变量及其打印可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/deniece1/article/details/102766346">deniece1的文章</a>。</p>
<h5 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h5><p>当我们使用shell运行程序的时候，以linux shell为例，我们在输入执行命令后，execve首先会调用一个驻留在存储器中的<strong>加载器</strong>(loader)，这个加载器会先读取可执行文件的头，校验它的正确性，接着将其中的代码和数据从磁盘复制到内存中，接着通过跳转到程序的第一条指令或者入口点来运行该程序（也就是把PC定位到第一条指令的地址），这个过程叫做<strong>加载</strong>。</p>
<p>从细节上，上一节其实对地址空间的描述还不够细致，事实上，地址空间从代码段开始的0x400000，还有读&#x2F;写段、运行时堆、共享库的内存映射区域和用户栈（并且数据与代码间为了.data段的前后对齐而留有空隙）。用户栈从最大合法用户地址，也就是上一回提到的那个第三个G的尾巴开始，向较小地址反向拓展。</p>
<p>接下来可以参考第一回的内容，在程序header的引导下，加载器调用mmap进行映射，具体而言是一种“按需分页”的方法，不会一下子将所有的代码段以及数据段的数据加载到内存，而是通过<strong>缺页中断</strong>（当软件试图访问已映射在虚拟地址空间中，但是目前并未被加载在物理内存中的一个分页时，由中央处理器的内存管理单元所发出的中断）来实现懒加载，而这些被分页的程序段就叫做<strong>chunk</strong>。</p>
<p>加载器接下来会让PC指向程序的<code>start</code>，<code>start</code>又指向系统启动函数<code>__libc_start_main</code>，该函数定义在系统库<code>libc.so</code>中，以初始化执行环境并调用main函数进行处理，一定情况下需要返回信息给内核。<code>__libc_start_main</code>的严格定义如下：</p>
<pre><code>int __libc_start_main(int *(main) (int, char * *, char * *), int argc, char * * ubp_av, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void (* stack_end));
</code></pre>
<h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><p>接下来，启动代码设置栈，并将控制权和变量传递给用户层的，也就是程序的主函数main。堆栈的结构自栈底到栈顶依次是：环境变量、命令行、envp、argv、libc_start_main的栈帧、main未来的栈帧。</p>
<p>main的定义比较简单：</p>
<pre><code>int main(int argc,char **argv, char **envp);
</code></pre>
<p>接下来，程序按照既定顺序执行代码。当程序的主函数结束，<code>__libc_start_main</code>将控制传递给exit，结束进程。</p>
<p>不过从理论上，加载器本身作为一个程序，也需要被shell通过execve调用，按这么说，execve调用加载器，加载器需要execve启动，然后要加载器加载加载器，接下来就是加载器加载加载加载器的加载器……</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%AD-4.png"></p>
<p>好了，不开玩笑了。事实上，因为是execve调用的加载器，所以你单独使用execve还是不会发生上述的套娃，就算在进程中使用execve调用加载器，也只会发生加载器加载加载器的情况，点到为止。</p>
<h5 id="fork-execve"><a href="#fork-execve" class="headerlink" title="fork + execve"></a>fork + execve</h5><p>然而，光使用execve还不够，因为execve是在当前进程的上下文中打开相应的程序，而非新创建一个进程：</p>
<blockquote>
<p>system是在单独的进程中执行命令，完了还会回到你的程序中。而exec函数是直接在你的进程中执行新的程序，新的程序会把你的程序覆盖，除非调用出错，否则你再也回不到exec后面的代码，就是说你的程序就变成了exec调用的那个程序了。</p>
<p>——摘自<a target="_blank" rel="noopener" href="https://blog.csdn.net/i792439187/article/details/8826745">挨踢的小胖的文章</a></p>
</blockquote>
<p>因此，我们往往需要利用fork+execve的形式来创建一个全新的进程。一个简单的自定义进程创建大概长这样：</p>
<pre><code>pid = fork();
if (pid &lt; 0) exit(-1);
else if (pid == 0)execve([your progress], [argv], NULL);
else&#123;
    wait();
    exit(0);
&#125;
</code></pre>
<hr>
<p>到此为止，我们终于把程序的运行机理，进程的创建机理给深入分析了一番。至于接下来的内容嘛……还是那句话：</p>
<p><img src="https://raw.githubusercontent.com/cykahankxd/cykapicxd/main/img/%E7%AC%AC%E4%BA%94%E7%AF%87%E4%B8%AD-5.png"></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">学习</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="2023/06/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC%E4%BA%94%E7%AF%87%EF%BC%88%E4%B8%AD%EF%BC%89/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><a class="page-number" href="page/3/">3</a><a class="page-number" href="page/4/">4</a><a class="extend next" rel="next" href="page/2/">Next &amp;raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2024 Driven·Cyka·Hank
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">CTF</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">杂谈</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">mc模组开发</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">学习</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">开发日志</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="https://ctf.webvpn.nefu.edu.cn/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NSICTF本部</a>
            </li>
          
            <li class="search-li">
              <a href="https://ctf.webvpn.nefu.edu.cn/bbs/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NSICTF官方BBS</a>
            </li>
          
            <li class="search-li">
              <a href="https://googles.plus" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NSICTF-sfc9982</a>
            </li>
          
            <li class="search-li">
              <a href="https://harry0597.com" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NSICTF-0HB</a>
            </li>
          
            <li class="search-li">
              <a href="https://blog.477.moe/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NSICTF-b477eRy</a>
            </li>
          
            <li class="search-li">
              <a href="https://xn--upon-eu0gs25bb4rvft66lyw5dlzd.googles.icu/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NSICTF-UPON</a>
            </li>
          
            <li class="search-li">
              <a href="https://www.0error.net/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NSICTF-Do1phin</a>
            </li>
          
            <li class="search-li">
              <a href="https://space.bilibili.com/510470351/?spm_id_from=333.999.0.0" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>NepNep⭐</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">雲高き&lt;br&gt;日暮れの空に&lt;br&gt;心燃ゆ</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>